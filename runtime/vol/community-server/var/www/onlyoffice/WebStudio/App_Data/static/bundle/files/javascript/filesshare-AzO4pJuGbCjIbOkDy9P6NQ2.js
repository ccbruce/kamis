typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,ctrl:17,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,F2:113},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,"async":!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(f){throw"Can't translate xml : "+f;}try{i=jq("<div>").append(u).html()}catch(f){throw"Can't serialized xml : "+f;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();
window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},r=!0,u=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},i=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var u,f,r=0;r<i.length;r++)if(u=i[r],u.eventType==n&&u.params==JSON.stringify(t)){if(f=new Date-u.timeStamp,0<f&&f<p)return c.apply(this,u.data),!0;i.splice(r,1);r--}return!1},k=function(n){for(var r,t=0;t<i.length;t++)r=i[t],r.eventType==n&&(i.splice(t,1),t--)},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},d=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},g=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=d(t[n]),t[n][f]={handler:i,type:u},f)},nt=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},tt=function(){var i,n,r,t;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),i=e,arguments.length===0)return i;for(n=0,r=arguments.length-1;n<r;n++)i+=arguments[n]+a;return t=i+arguments[n],ASC.Files.Utility&&(t=ASC.Files.Utility.AddExternalShareKey(t)),t+((t.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,i,f,e){var y,c,w,k;if(r=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(!f.responseXML&&f.responseText.indexOf("<error")==0)try{f.responseXML=ASC.Files.TemplateManager.createXML(f.responseText)}catch(d){}if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(i){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=JSON.parse(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||JSON.parse(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);u.length!=0&&r==!0&&(k=u.shift(),r=!1,l(k))},it=function(n,t,r){return function(){for(var u=[n,t,r],f=0,e=arguments.length;f<e;f++)u.push(arguments[f]);jq.inArray(n,w())>=0&&i.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:u});c.apply(this,u)}},n=function(n,t,i,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof i=="string"&&(typeof f=="undefined"&&(f={}),!b(i,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":case"put":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={"async":f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:tt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:it(i,f,t)};u.length==0&&r==!0?(r=!1,l(c)):u.push(c)}},l=function(n){jq.ajax({"async":n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},rt=function(t,i){i.ajaxsync=!0;n("post","xml",t,i,null,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},ut=function(t,i){i.ajaxsync=!0;n("post","xml",t,i,null,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID||"")+"&title="+encodeURIComponent(i.fileTitle)+"&templateId="+encodeURIComponent(i.templateId||""))},ft=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},et=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},st=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},ht=function(t,i,r){n("post","json",t,i,r,"folders-entries?filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},ct=function(t,i){i.ajaxsync=!0;n("get",i.dataType||"xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},lt=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},at=function(t,i){n("put","json",t,i,null,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},vt=function(t,i){n("put","json",t,i,null,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},yt=function(t,i){n("put","json",t,i,null,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},pt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&parentId="+encodeURIComponent(i.folderId||"")+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},wt=function(t,i){n("get","json",t,i,"presigned?fileId="+encodeURIComponent(i.fileId))},bt=function(t,i){n("put","xml",t,i,null,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},kt=function(t,i){n("put","xml",t,i,null,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},dt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},gt=function(t,i,r){n("put","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},ni=function(t,i,r){n("put","json",t,i,r,"folders-files?action=delete")},ti=function(t,i){n("put","json",t,i,null,"emptytrash")},ii=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("put","json",t,i,r,"bulkdownload")},ri=function(t,i){n("get","json",t,i,"tasks-statuses")},ui=function(t,i){n("put","json",t,i,null,"tasks")},fi=function(t,i){n("get","json",t,i,"autocleanup")},ei=function(t,i,r){n("post","json",t,i,r,"checkediting")},oi=function(t,i){n("put","json",t,i,null,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},si=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},hi=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},ci=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},li=function(t,i,r){n("post","json",t,i,r,"removeace")},ai=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId)+(i.linkId?"&linkId="+encodeURIComponent(i.linkId):"")+"&isFolder="+(i.isFolder===!0))},vi=function(t,i){n("get","json",t,i,"getexternallink?entryId="+encodeURIComponent(i.entryId))},yi=function(t,i){n("get","json",t,i,"publickeys?fileId="+encodeURIComponent(i.fileId))},pi=function(t,i){n("get","json",t,i,"sharedusers?fileId="+encodeURIComponent(i.fileId))},wi=function(t,i){n("get","json",t,i,"protectusers?fileId="+encodeURIComponent(i.fileId))},bi=function(t,i,r){n("post","json",t,i,r,"sendeditornotify?fileId="+encodeURIComponent(i.fileId))},ki=function(t,i){n("put","json",t,i,null,"external?enable="+(i.enable===!0))},di=function(t,i){n("put","json",t,i,null,"externalsocialmedia?enable="+(i.enable===!0))},gi=function(t,i,r){n("post","json",t,i,r,"checkconversion")},nr=function(t,i){n("put","json",t,i,null,"updateifexist?set="+i.value)},tr=function(t,i){n("put","json",t,i,null,"forcesave?set="+i.value)},ir=function(t,i){n("put","json",t,i,null,"storeforcesave?set="+i.value)},rr=function(t,i){n("put","json",t,i,null,"changedeleteconfrim?set="+i.value)},ur=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},fr=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},er=function(t,i){n("delete","json",t,i,"thirdparty-delete?providerId="+i.providerId)},or=function(t,i){n("put","json",t,i,null,"thirdparty?enable="+(i.enable===!0))},sr=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},hr=function(t,i){n("delete","json",t,i,"docusign-delete")},cr=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},lr=function(t,i,r){n("put","json",t,i,r,"markasread")},ar=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},vr=function(t,i){n("get","xml",t,i,"gettemplates?filter="+i.filter+"&from="+i.from+"&count="+i.count+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},yr=function(t,i){n("put","xml",t,i,null,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},pr=function(t,i){n("put","json",t,i,null,"file-favorite?fileId="+encodeURIComponent(i.fileId)+"&favorite="+(i.favorite===!0))},wr=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},br=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},kr=function(t,i){n("put","json",t,i,null,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},kr=function(t,i){n("put","json",t,i,null,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},dr=function(t,i){n("get","json",t,i,"reference-data?fileKey="+encodeURIComponent(i.fileKey)+"&instanceId="+encodeURIComponent(i.instanceId)+"&sourceFileId="+encodeURIComponent(i.sourceFileId)+"&path="+encodeURIComponent(i.path))},gr=function(t,i){n("get","json",t,i,"mailaccounts")},nu=function(t,i){n("get","json",t,i,"gethelpcenter")},tu=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:g,unbind:nt,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetAutoCleanup:"GetAutoCleanup",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",GetMediaFile:"getmediafile",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",GetFileSharedInfo:"getfilesharedinfo",SetAceFileLink:"setacefilelink",GetEncryptionAccess:"getencryptionaccess",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",GetExternalLink:"getexternallink",GetPresignedUri:"getpresigneduri",ChangeExternalShareSettings:"changeexternalsharesettings",ChangeExternalShareSocialMediaSettings:"changeexternalsharesocialmediasettings",GetUsers:"getusers",SendEditorNotify:"sendeditornotify",MarkAsRead:"markasread",GetNews:"getnews",ToggleFavorite:"togglefavorite",GetTemplates:"gettemplates",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",Forcesave:"forcesave",StoreForcesave:"storeforcesave",GetHelpCenter:"gethelpcenter",ChangeDeleteConfrim:"changedeleteconfrim",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetReferenceData:"getreferencedata",GetReferenceLink:"getreferencelink",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:rt,createNewFile:ut,getFolderItems:ft,getTreeSubFolders:et,getTreePath:ot,getFolder:st,getItems:ht,getFile:ct,getFileHistory:lt,setCurrentVersion:at,updateComment:vt,completeVersion:yt,getSiblingsImage:pt,getPresignedUri:wt,renameFolder:bt,renameFile:kt,changeOwner:tu,moveFilesCheck:dt,moveItems:gt,deleteItem:ni,emptyTrash:ti,download:ii,getTasksStatuses:ri,terminateTasks:ui,checkEditing:ei,getAutoCleanup:fi,setAceLink:oi,getSharedInfo:si,getSharedInfoShort:hi,setAceObject:ci,unSubscribeMe:li,getShortenLink:ai,getExternalLink:vi,getEncryptionAccess:yi,changeExternalShareSettings:ki,changeExternalShareSocialMediaSettings:di,getSharedUsers:pi,getProtectUsers:wi,sendEditorNotify:bi,checkConversion:gi,updateIfExist:nr,forcesave:tr,storeForcesave:ir,changeDeleteConfrim:rr,getThirdParty:ur,saveThirdParty:fr,deleteThirdParty:er,changeAccessToThirdparty:or,saveDocuSign:sr,deleteDocuSign:hr,sendDocuSign:cr,markAsRead:lr,getNews:ar,getTemplates:vr,lockFile:yr,toggleFavorite:pr,removeFromCache:k,getEditHistory:wr,getDiffUrl:br,restoreVersion:kr,getReferenceData:dr,getMailAccounts:gr,getHelpCenter:nu}}();
window.ASC.Files.UI=function(){var t=!1,i=null,u=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),n=function(){var t=null,n=[];return{getFiles:function(){return n},setFolder:function(i){i!=t&&(t=i,n=[])},setFile:function(t){n.indexOf(t)<0&&n.push(t)}}}(),f=function(){t===!1&&(t=!0);jq(window).on("resize",function(){r();ASC.Files.UI.fixContentHeaderWidth();e()});jq(window).on("resizeWinTimerWithMaxDelay",function(){r();ASC.Files.UI.fixContentHeaderWidth()});if(!ASC.Resources.Master.IsAuthenticated){ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:!1};return}var n=function(n){var t=n.IsAutoCleanUp,i=n.Gap;ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:t,gap:i};t||jq("#selectGapToAutoCleanUp").val("1").trigger("change")};ASC.Files.ServiceManager&&(ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetAutoCleanup,n),ASC.Files.ServiceManager.getAutoCleanup(ASC.Files.ServiceManager.events.GetAutoCleanup))},e=function(){jq("#filesMainContent").hasClass("thumbnails")&&(jq("#contentVersions").remove(),clearTimeout(i),i=setTimeout(function(){var n=jq(".display-versions");n.length&&ASC.Files.Folders.showVersions(n)},500))},o=function(){},s=function(n){n=jq(n);n.hasClass("display-versions")&&ASC.Files.Folders.closeVersions();n.remove()},h=function(n,t){if(n&&t){if(!ASC.Files.Common.isCorrectId(t))return null;var i=ASC.Files.UI.getObjectData(".to-parent-folder-dropdown");return i!=null&&i.entryId==t&&i.entryType==n?jq(".to-parent-folder-dropdown"):jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t))}return null},c=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},l=function(n){var u,r,f,i,t;return(n=jq(n),u='input:hidden[name="entry_data"]',r=n.parent(),n.is(".to-parent-folder-link")||r.is(".to-parent-folder-dropdown")||r.is("#filesBreadCrumbs")?n=r:n.is(".file-row")||(f=".file-row",n.is(".jstree *")?(f=".tree-node",u='> a input:hidden[name="entry_data"]'):n.closest("#contentVersions").length&&(n=jq(".display-versions")),n=n.closest(f)),n.length==0)?null:(i=n.find(u),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.content_length_string=i.attr("data-content_length_string"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.deny_download=i.attr("data-deny_download")==="true",t.deny_sharing=i.attr("data-deny_sharing")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t.folderUrl=i.attr("data-folder_url"),t.folder_id=i.attr("data-folder_id"),t.folder_is_favorite=i.attr("data-folder_is_favorite"),t.encrypted=i.attr("data-encrypted")==="true",t.thumbnail_status=i.attr("data-thumbnail_status"),t.deleted_permanently_date=i.attr("data-deleted_permanently_date"),t.parent_folder_id=i.attr("data-parent_folder_id"),t)},a=function(n,t,i){if(n=jq(n),n.length!=0){var r=n.find('input:hidden[name="entry_data"]');r.length&&r.attr(t,i)}},v=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},y=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},p=function(n){return(n=jq(n),n.is(".file-row")||n.is(".to-parent-folder-dropdown")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},w=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)?r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(i,!0)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.MediaPlayer.getPlayHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},b=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},k=function(t){var u=ASC.Files.Constants.storageKeyCompactView,i,r;typeof t=="undefined"&&(i=localStorageManager.getItem(u)||!1,t=i,typeof i=="boolean"&&(t=i?"compact":"normal"));ASC.Files.Folders.closeVersions();jq("#switchViewFolder, #filesMainContent").removeClass("thumbnails normal compact");jq("#switchViewFolder, #filesMainContent").addClass(t);localStorageManager.setItem(u,t);t=="thumbnails"?(jq("#filesMainContent").find(".file-row .thumb-img img[src='']").each(function(){var n=jq(this),t=n.attr("data-src");n.on("error",ASC.Files.EventHandler.onThumbnailError).attr("src",t)}),jq("#filesMainContent").css("display","grid"),r=n.getFiles(),r.length&&Teamlab.createThumbnails(null,{fileIds:r})):jq("#filesMainContent").css("display","block");ASC.Files.Folders.showMore&&t!="compact"&&ASC.Files.UI.trackShowMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},d=function(){return jq("#settingCommon, #settingAdmin, #settingThirdPartyPanel, #helpPanel").is(":visible")},g=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},r=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},nt=function(){var n=jq("#mainContentHeader .down_arrow");n.length&&(ASC.Files.UI.stickMovingPanel("mainContentHeader",jq("#filesSelectorPanel:visible")),ASC.Files.UI.fixContentHeaderWidth())},tt=function(n,t){var i=jq("#"+n),u,r,o,f,s,e;i.is(":visible")&&(t&&t.hide(),u=n+"Spacer",r=jq("#"+u),o=jq("#"+u+":visible").length==0?i.offset().top:r.offset().top,f=jq(window),s=f.scrollTop(),s>=o?(i.hasClass("stick-panel")||(r.length==0&&(e=document.createElement("div"),e.id=u,document.body.appendChild(e),r=jq("#"+u),r.insertAfter(i),r.css({height:i.css("height"),"padding-bottom":i.css("padding-bottom"),"padding-top":i.css("padding-top")})),r.show(),i.addClass("stick-panel")),i.css("left",i.parent().offset().left-f.scrollLeft())):i.hasClass("stick-panel")&&(r.hide(),i.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto")))},it=function(n){typeof n=="undefined"&&(n=jq(window).width()>=1200||ASC.Desktop);n?jq(".files-content-panel").height()-jq(".mainPageContent").height()<=jq(".mainPageContent").scrollTop()+350&&ASC.Files.Folders.showMore():jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore()},rt=function(){var n=jq("#filesTemplateList .file-row");n.eq(n.length-1).position().top==271&&ASC.Files.Folders.getTemplateList(!0)},ut=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},ft=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&!n.hasClass("to-parent-folder-dropdown")&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position",""));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},et=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},ot=function(n){return n.hasClass("file-locked-by")},st=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},ht=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},ct=function(t){var u=t||jq("#filesMainContent .file-row"),i=jq("#filesMainContent .files-separator").length>0,r;n.setFolder(ASC.Files.Folders.currentFolder.id);r=ASC.Files.UI.autoCleanUpSetting.isAutoCleanUp;u.each(function(){var u=ASC.Files.UI.getObjectData(this),h=u.entryId,f=u.entryType,t=u.entryObject,o=u.title,s,a,e,c,l,v;ASC.Files.Folders.folderContainer=="trash"?(t.find(".file-lock").remove(),t.find(".template-action").remove(),t.find(".entry-descr .title-created").remove(),t.find(".entry-descr .title-removed").show(),f=="folder"&&(t.find(".create-date").remove(),t.find(".modified-date").show()),r?(t.find(".entry-descr .title-removed").remove(),t.find(".create-date").remove(),t.find(".modified-date").remove(),t.find(".deleted-permanently").show(),t.find(".entry-descr .title-removed-permanently").show()):(t.find(".entry-descr .title-removed-permanently").remove(),t.find(".entry-descr .title-removed").show(),t.find(".deleted-permanently-date").remove(),t.find(".modified-date").show())):(t.find(".entry-descr .title-removed").remove(),t.find(".entry-descr .title-removed-permanently").remove(),t.find(".deleted-permanently-date").remove(),f=="folder"&&t.find(".modified-date").remove());s=t.find(".entry-title .name a");a=f=="file"?ASC.Files.Utility.getCssClassByFileTitle(o):ASC.Files.Utility.getFolderCssClass();t.find(".thumb-img, .thumb-"+f).addClass(a);u.thumbnail_status!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(u)||n.setFile(h);u.thumbnail_status==1&&t.find(".thumb-img img").attr("data-src",ASC.Files.Utility.GetFileThumbnailUrl(h,u.version));f!="folder"||ASC.Files.Folders.folderContainer=="forme"||t.hasClass("new-folder")||t.addClass("min");f!="file"||i||ASC.Files.Folders.folderContainer=="forme"||(t.before("<div class='files-separator'><\/div>"),i=!0);t.hasClass("checkloading")||(ASC.Resources.Master.IsAuthenticated||t.addClass("without-share"),f=="file"?(s.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(s,o),ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h,o),s.attr("href",e).attr("target","_blank"),c=t.find(".file-lock"),ASC.Files.UI.accessEdit(u,t)?t.hasClass("file-locked")&&(l=ASC.Files.FilesJSResource.TitleLockedFile,ASC.Files.UI.lockedForMe(t)&&(v=c.attr("data-name"),l=ASC.Files.FilesJSResource.TitleLockedFileBy.format(v),(ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")&&t.addClass("file-can-unlock")),c.attr("title",l)):c.remove()),ASC.Files.Utility.MustConvert(o)&&!u.encrypted?(t.find(".pencil:not(.convert-action)").remove(),(!ASC.Resources.Master.IsAuthenticated||Teamlab.profile.isVisitor)&&!ASC.Files.UI.accessEdit()||ASC.Files.UI.denyDownload(u)||ASC.Files.Folders.folderContainer=="trash"?t.find(".convert-action").remove():t.find(".convert-action").show()):ASC.Files.Utility.CanWebRestrictedEditing(o)&&!u.encrypted?(t.find(".pencil:not(.fillform-action)").remove(),ASC.Files.UI.editableFile(u)?t.find(".fillform-action").show():t.find(".fillform-action").remove()):(u.encrypted&&(ASC.Desktop?(e=ASC.Files.Utility.GetFileWebEditorUrl(h),s.attr("href",e),t.find(".file-edit").attr("href",e)):(s.removeAttr("href"),t.find(".file-edit").removeAttr("href"))),ASC.Files.UI.editableFile(u)&&(!u.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(o)&&ASC.Desktop&&ASC.Desktop.encryptionSupport())?(ASC.Files.UI.lockEditFile(t,ASC.Files.UI.editingFile(t)),t.find(".convert-action, .fillform-action").remove(),ASC.Files.Utility.CanCoAuhtoring(o)&&!t.hasClass("on-edit-alone")&&t.addClass("can-coauthoring"),u.encrypted||(e=ASC.Files.Utility.GetFileWebEditorUrl(h),t.find(".file-edit").attr("href",e))):(t.addClass("cannot-edit"),t.find(".pencil").remove())),u.encrypted&&(ASC.Files.Folders.folderContainer!="privacy"||!ASC.Desktop||!ASC.Desktop.encryptionSupport()||ASC.Resources.Master.Personal)?t.addClass("without-share"):ASC.Resources.Master.Personal&&!ASC.Files.Utility.CanWebView(o)&&t.addClass("without-share")):ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h),s.attr("href",e)),(ASC.Files.Folders.folderContainer=="trash"||u.error)&&s.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")?ASC.Files.Folders.folderContainer!="forme"||u.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite||u.deny_sharing||Teamlab.profile.isVisitor||t.addClass("can-share"):(ASC.Files.Folders.folderContainer=="forme"&&(!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Files.Folders.folderContainer=="privacy"&&(f=="folder"||!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Resources.Master.Personal&&f=="folder"||Teamlab.profile.isVisitor===!0)&&t.addClass("without-share"),jq.browser.msie&&t.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},lt=function(n,t){var r=jq.fixEvent(n);if(!(r.button==0||jq.browser.msie&&r.button==1))return!0;t=t||jq(r.srcElement||r.target);try{if(t.is("a, .menu-small"))return!0}catch(r){return!0}var i=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(i).hasClass("row-selected")||jq(i).find(".checkbox input:visible").is("[type=radio]"),o=!jq(i).find(".checkbox input:visible").prop("disabled");if(r.shiftKey){ASC.Files.UI.lastSelectedEntry||(ASC.Files.UI.lastSelectedEntry=i);u=!0;var f=jq(".file-row").index(i),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),s=Math.min(f,e),h=Math.max(f,e);jq(".file-row:lt("+h+"):gt("+s+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else r.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return o&&(ASC.Files.UI.selectRow(i,u),ASC.Files.UI.updateMainContentHeader()),ASC.Files.UI.lastSelectedEntry=u?{entryObj:i}:null,!0},at=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input[type=checkbox]:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},vt=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},yt=function(n){var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("checked",n===!0||t===!0);jq("#filesSelectAllCheck").prop("indeterminate",t)},pt=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},wt=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"media":t=(ASC.Files.Utility.FileIsAudio(i)||ASC.Files.Utility.FileIsVideo(i))&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},bt=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},kt=function(n,t,i){var r,u,f;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),r=n?n.entryId:null,u=n?n.entryType:null,u=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_RECENT||r==ASC.Files.Constants.FOLDER_ID_FAVORITES||r==ASC.Files.Constants.FOLDER_ID_TEMPLATES||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;f=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);u=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(f=parseInt(ASC.Files.Folders.currentFolder.access));switch(f){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.CustomFilter:case ASC.Files.Constants.AceStatusEnum.Review:case ASC.Files.Constants.AceStatusEnum.FillForms:case ASC.Files.Constants.AceStatusEnum.Comment:return!!i;default:return n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_RECENT||n.entryId===ASC.Files.Constants.FOLDER_ID_FAVORITES||n.entryId===ASC.Files.Constants.FOLDER_ID_TEMPLATES||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)?!1:ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id}},dt=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(ASC.Files.UI.removeEntryObject(n),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},gt=function(n){return!n||!n.deny_download?!1:n.access==ASC.Files.Constants.AceStatusEnum.Read||n.access==ASC.Files.Constants.AceStatusEnum.Comment},ni=function(n){return n?n.access!=ASC.Files.Constants.AceStatusEnum.None&&n.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite?!0:n.access==ASC.Files.Constants.AceStatusEnum.ReadWrite&&n.deny_sharing:!1},ti=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},ii=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResource.TitleEditingFile;i&&(r=ASC.Files.FilesJSResource.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},ri=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:visible:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},ui=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},fi=function(n,t,i){var f;n=n||ASC.Files.UI.getEntryObject(t,i);var h=localStorageManager.getItem(ASC.Files.Constants.storageKeyCompactView)=="thumbnails"?!0:!1,r=ASC.Files.UI.getObjectData(n),c={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length_string:r.content_length_string,thumbnail:r.thumbnail_status==1&&!h?ASC.Files.Utility.GetFileThumbnailUrl(i,r.version):!1,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},l=ASC.Files.Common.jsonToXml(c),a=ASC.Files.TemplateManager.translateFromString(l),u=n.find(".checkbox"),e=jq("#entryTooltip"),o=jq(window),s=12;e.html(a);f=u.offset().top+u.outerHeight()+e.outerHeight()+s>o.height()+o.scrollTop();jq.dropdownToggle().toggle(u,"entryTooltip",f?s:0,0,!1,null,null,null,f)},ei=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},oi=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):(ASC.Files.Folders.folderContainer||!ASC.Resources.Master.IsAuthenticated)&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},si=function(n,t){var r=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1&&ASC.Files.Tree.getParentId(ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-1]),e,i;if(r){if(e=ASC.Files.Tree.getFolderTitle(r),jq(n).attr("data-id",r).attr("href",ASC.Files.UI.getEntryLink("folder",r)).attr("title",e),n==".to-parent-folder-dropdown"){var f=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-1],o=ASC.Files.Tree.getFolderTitle(f),u=jq("#filesBreadCrumbs");u.find(".rename-action").remove();u.find("#promptRenameParentFolder").hide();u.find(".to-parent-folder-link").show().find(".inner-ellipsis").text(o);u.find("#linkCurrentFolder").attr("href",ASC.Files.UI.getEntryLink("folder",f));i=ASC.Files.Tree.getFolderData(f);jq(n).attr("title",o).children('input[name="entry_data"]').attr("data-deny_download",i.deny_download).attr("data-deny_sharing",i.deny_sharing).attr("data-access",i.access).attr("data-shared",i.shared).attr("data-id",i.id).attr("data-create_by_id",i.create_by_id).attr("data-title",i.title).attr("data-folder_id",i.folder_id).attr("data-provider_key",i.provider_key).attr("data-provider_id",i.provider_id).attr("data-parent_folder_id",r)}jq(t||n).show()}else jq(t||n).hide(),ASC.Files.UI.removeDataFromButtonBack()},hi=function(){jq(".to-parent-folder-dropdown").children('input[name="entry_data"]').attr("data-deny_download","").attr("data-deny_sharing","").attr("data-access","").attr("data-shared","").attr("data-id","").attr("data-create_by_id","").attr("data-title","").attr("data-folder_id","").attr("data-provider_key","").attr("data-provider_id","").attr("data-parent_folder_id","");jq(".to-parent-folder-link .inner-ellipsis").text("")},ci=function(n){jq(n).off("keyup").on("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},li=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ai=function(n){ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView&&ASC.Files.MediaPlayer.closePlayer();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"),jq("#mainContentHeader, .files-filter").hide());jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon, #settingAdmin").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},vi=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},yi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsCommon)},pi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-admin").addClass("active");jq("#settingAdmin").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsAdmin)},wi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleMoreFeaturs)},bi=function(){return jq("#personalLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#personalLimitExceedStoragePanel",500),!0):!1},ki=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500),!0):!1},di=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500),!0):!1},gi=function(n,t){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t)},nr=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},tr=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&u.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:f,parseItemId:v,removeEntryObject:s,getEntryObject:h,getObjectData:l,setObjectData:a,getSelectorId:c,getEntryTitle:y,getObjectTitle:p,getEntryLink:w,currentPage:0,amountPage:0,countTotal:0,autoCleanUpSetting:null,updateFolderView:b,switchFolderView:k,isSettingsPanel:d,blockObjectById:ut,blockObject:ft,highlightExtension:ht,addRowHandlers:ct,updateMainContentHeader:at,lastSelectedEntry:null,checkSelectAll:pt,checkSelect:wt,selectRow:vt,clickRow:lt,resetSelectAll:yt,displayInfoPanel:bt,editingFile:et,editableFile:st,lockedForMe:ot,checkEditing:ri,timeCheckEditing:null,checkEditingDefer:ui,lockEditFileById:ti,lockEditFile:ii,accessEdit:kt,accessDelete:dt,denyDownload:gt,denySharing:ni,checkCharacter:ci,canSetDocumentTitle:!0,setDocumentTitle:li,stickContentHeader:nt,fixContentHeaderWidth:g,stickMovingPanel:tt,trackShowMore:it,trackShowMoreTemplates:rt,displayEntryTooltip:fi,hideEntryTooltip:ei,timeTooltip:null,removeDataFromButtonBack:hi,checkEmptyContent:oi,checkButtonBack:si,hideAllContent:ai,displayHelp:vi,displayCommonSetting:yi,displayAdminSetting:pi,displayMoreFeaturs:wi,displayPersonalLimitStorageExceed:bi,displayTariffLimitStorageExceed:ki,displayTariffFileSizeExceed:di,blockUI:gi,setProgressValue:nr,filesSelectedHandler:o,registerUserProfilePopup:tr}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").on("click",function(){ASC.Files.UI.switchFolderView("normal")});jq("#switchToCompact").on("click",function(){ASC.Files.UI.switchFolderView("compact")});jq("#switchToThumbnails").on("click",function(){ASC.Files.UI.switchFolderView("thumbnails")});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).trigger("blur");ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").on("click",function(){return jq(document).scrollTop(0),document.querySelector(".mainPageContent").scrollTo(0,0),!1});jq(document).on("keydown",function(n){var t,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);i=t.target||t.srcElement;try{if(jq(i).is("input,textarea"))return!0}catch(t){return!0}return(r=t.keyCode||t.which,r==ASC.Files.Common.keyCode.A&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").trigger("focus")},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).on("keyup",function(n){var t,u,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);u=t.target||t.srcElement;try{if(jq(u).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey&&!t.altKey)return ASC.Files.Folders.deleteItem(),!1;if(i==ASC.Files.Common.keyCode.F&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if(i==ASC.Files.Common.keyCode.N&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1;i==ASC.Files.Common.keyCode.F2&&jq("#filesMainContent .file-row.row-selected:visible").length==1&&(r=ASC.Files.UI.getObjectData(jq("#filesMainContent .file-row.row-selected")),ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.rename(r.entryType,r.id))}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()})})}(jQuery);
/*!
 * clipboard.js v1.6.1
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT  Zeno Rocha
 */
!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.Clipboard=n()}}(function(){var n;return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){function r(n,t){for(;n&&n.nodeType!==u;){if(n.matches(t))return n;n=n.parentNode}}var u=9,i;"undefined"==typeof Element||Element.prototype.matches||(i=Element.prototype,i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector);t.exports=r},{}],2:[function(n,t){function i(n,t,i,u,f){var e=r.apply(this,arguments);return n.addEventListener(i,e,f),{destroy:function(){n.removeEventListener(i,e,f)}}}function r(n,t,i,r){return function(i){i.delegateTarget=u(i.target,t);i.delegateTarget&&r.call(n,i)}}var u=n("./closest");t.exports=i},{"./closest":1}],3:[function(n,t,i){i.node=function(n){return void 0!==n&&n instanceof HTMLElement&&1===n.nodeType};i.nodeList=function(n){var t=Object.prototype.toString.call(n);return void 0!==n&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in n&&(0===n.length||i.node(n[0]))};i.string=function(n){return"string"==typeof n||n instanceof String};i.fn=function(n){var t=Object.prototype.toString.call(n);return"[object Function]"===t}},{}],4:[function(n,t){function r(n,t,r){if(!n&&!t&&!r)throw new Error("Missing required arguments");if(!i.string(t))throw new TypeError("Second argument must be a String");if(!i.fn(r))throw new TypeError("Third argument must be a Function");if(i.node(n))return u(n,t,r);if(i.nodeList(n))return f(n,t,r);if(i.string(n))return e(n,t,r);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");}function u(n,t,i){return n.addEventListener(t,i),{destroy:function(){n.removeEventListener(t,i)}}}function f(n,t,i){return Array.prototype.forEach.call(n,function(n){n.addEventListener(t,i)}),{destroy:function(){Array.prototype.forEach.call(n,function(n){n.removeEventListener(t,i)})}}}function e(n,t,i){return o(document.body,n,t,i)}var i=n("./is"),o=n("delegate");t.exports=r},{"./is":3,delegate:2}],5:[function(n,t){function i(n){var t,r,i,u;return"SELECT"===n.nodeName?(n.focus(),t=n.value):"INPUT"===n.nodeName||"TEXTAREA"===n.nodeName?(r=n.hasAttribute("readonly"),r||n.setAttribute("readonly",""),n.select(),n.setSelectionRange(0,n.value.length),r||n.removeAttribute("readonly"),t=n.value):(n.hasAttribute("contenteditable")&&n.focus(),i=window.getSelection(),u=document.createRange(),u.selectNodeContents(n),i.removeAllRanges(),i.addRange(u),t=i.toString()),t}t.exports=i},{}],6:[function(n,t){function i(){}i.prototype={on:function(n,t,i){var r=this.e||(this.e={});return(r[n]||(r[n]=[])).push({fn:t,ctx:i}),this},once:function(n,t,i){function r(){u.off(n,r);t.apply(i,arguments)}var u=this;return r._=t,this.on(n,r,i)},emit:function(n){var r=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),t=0,u=i.length;for(t;t<u;t++)i[t].fn.apply(i[t].ctx,r);return this},off:function(n,t){var u=this.e||(this.e={}),r=u[n],f=[],i,e;if(r&&t)for(i=0,e=r.length;i<e;i++)r[i].fn!==t&&r[i].fn._!==t&&f.push(r[i]);return f.length?u[n]=f:delete u[n],this}};t.exports=i},{}],7:[function(t,i,r){!function(u,f){if("function"==typeof n&&n.amd)n(["module","select"],f);else if("undefined"!=typeof r)f(i,t("select"));else{var e={exports:{}};f(e,u.select);u.clipboardAction=e.exports}}(this,function(n,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function u(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var i=r(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),o=function(){function n(t){u(this,n);this.resolveOptions(t);this.initSelection()}return e(n,[{key:"resolveOptions",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=n.action;this.emitter=n.emitter;this.target=n.target;this.text=n.text;this.trigger=n.trigger;this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,r="rtl"==document.documentElement.getAttribute("dir"),n;this.removeFake();this.fakeHandlerCallback=function(){return t.removeFake()};this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0;this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[r?"right":"left"]="-9999px";n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;document.body.appendChild(this.fakeElem);this.selectedText=i.default(this.fakeElem);this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null);this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=i.default(this.target);this.copyText()}},{key:"copyText",value:function(){var n=void 0;try{n=document.execCommand(this.action)}catch(t){n=!1}this.handleResult(n)}},{key:"handleResult",value:function(n){this.emitter.emit(n?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur();window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=n,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"');},get:function(){return this._action}},{key:"target",set:function(n){if(void 0!==n){if(!n||"object"!==("undefined"==typeof n?"undefined":f(n))||1!==n.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&n.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(n.hasAttribute("readonly")||n.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=n}},get:function(){return this._target}}]),n}();n.exports=o})},{select:5}],8:[function(t,i,r){!function(u,f){if("function"==typeof n&&n.amd)n(["module","./clipboard-action","tiny-emitter","good-listener"],f);else if("undefined"!=typeof r)f(i,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var e={exports:{}};f(e,u.clipboardAction,u.tinyEmitter,u.goodListener);u.clipboard=e.exports}}(this,function(n,t,i,r){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function e(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function o(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?n:t}function s(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}function f(n,t){var i="data-clipboard-"+n;if(t.hasAttribute(i))return t.getAttribute(i)}var h=u(t),c=u(i),l=u(r),a=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),v=function(n){function t(n,i){e(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(i),r.listenClick(n),r}return s(t,n),a(t,[{key:"resolveOptions",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof n.action?n.action:this.defaultAction;this.target="function"==typeof n.target?n.target:this.defaultTarget;this.text="function"==typeof n.text?n.text:this.defaultText}},{key:"listenClick",value:function(n){var t=this;this.listener=l.default(n,"click",function(n){return t.onClick(n)})}},{key:"onClick",value:function(n){var t=n.delegateTarget||n.currentTarget;this.clipboardAction&&(this.clipboardAction=null);this.clipboardAction=new h.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})}},{key:"defaultAction",value:function(n){return f("action",n)}},{key:"defaultTarget",value:function(n){var t=f("target",n);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(n){return f("text",n)}},{key:"destroy",value:function(){this.listener.destroy();this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],i="string"==typeof n?[n]:n,t=!!document.queryCommandSupported;return i.forEach(function(n){t=t&&!!document.queryCommandSupported(n)}),t}}]),t}(c.default);n.exports=v})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});
window.ASC.Desktop=function(){if(!window.AscDesktopEditor)return null;var i=!1,t=null,n=typeof window.AscDesktopEditor.cloudCryptoCommand=="function",u=/(AscDesktopEditor)[ \/]([\w.]+)/.exec(navigator.userAgent)[2],f=function(){i===!1&&(i=!0,t=new RegExp("^http(s)?://[^/]+").exec(location)[0],jq("#desktopWelcome").is(":visible")&&ASC.Files.UI.blockUI("#desktopWelcome",520),o())},e=function(){return n},o=function(){var i={displayName:ASC.Files.Editor?ASC.Files.Editor.docServiceParams.displayName:Teamlab.profile.displayName,domain:t,email:ASC.Files.Editor?ASC.Files.Editor.docServiceParams.email:Teamlab.profile.email,provider:"onlyoffice",uiTheme:ASC.Files.Editor?ASC.Files.Editor.configurationParams.editorConfig.customization.uiTheme:ASC.Resources.Master.ModeThemeSettings.ModeThemeName===1?"default-dark":"default-light",userId:ASC.Files.Editor?ASC.Files.Editor.configurationParams.editorConfig.user.id:Teamlab.profile.id},u;n&&(jq("#encryptionKeyPair").length?(u=jq("#encryptionKeyPair").val(),i.encryptionKeys=u?JSON.parse(u):{},i.encryptionKeys.cryptoEngineId="{FFF0E1EB-13DB-4678-B67D-FF0A41DBBCEF}"):n=ASC.Files.Editor&&ASC.Files.Editor.configurationParams.editorConfig.encryptionKeys);window.AscDesktopEditor.execCommand("portal:login",JSON.stringify(i));window.onSystemMessage=function(n){switch(n.type){case"operation":LoadingBanner&&LoadingBanner.displayLoading();var t=n.opMessage;if(!t)switch(n.opType){case 0:t=ASC.Files.FilesJSResource.DesktopMessageDownloading;break;case 1:t=ASC.Files.FilesJSResource.DesktopMessageEncrypting;break;default:t=ASC.Resources.Master.ResourceJS.LoadingProcessing}ASC.Files.UI.displayInfoPanel(t)}};window.DesktopUpdateFile=function(){ASC.Files.UI&&ASC.Files.UI.checkEditing()};n&&(window.cloudCryptoCommand=function(n,t,i){switch(n){case"encryptionKeys":r(t);break;case"updateEncryptionKeys":r(t,!0);break;case"relogin":var u="Encryption keys must be re-entered";ASC.Files.Editor?ASC.Files.Editor.docEditor.showMessage(u):ASC.Files.UI.displayInfoPanel(u,!0);s();break;case"getsharingkeys":if(!ASC.Files.Editor){i({});return}ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetEncryptionAccess,function(n,t,r){var f={keys:n};typeof r!="undefined"&&(ASC.Files.Editor?ASC.Files.Editor.docEditor.showMessage(u):ASC.Files.UI.displayInfoPanel(u,!0),f.error=u);i(f)},{once:!0});ASC.Files.ServiceManager.getEncryptionAccess(ASC.Files.ServiceManager.events.GetEncryptionAccess,{fileId:ASC.Files.Editor.docServiceParams.fileId})}})},s=function(){setTimeout(function(){var n={domain:t,onsuccess:"reload"};window.AscDesktopEditor.execCommand("portal:logout",JSON.stringify(n))},1e3)},h=n?function(n){var i=u.split("."),t;i[0]<=7&&i[1]<=3&&i[2]<4?(t=jq(ASC.Files.Utility.Resource.ExtsWebEncrypt).map(function(n,t){return"*"+t}).toArray().join(" "),!t.length||(t="("+t+")")):t="cryptofiles";window.AscDesktopEditor.cloudCryptoCommand("upload",{cryptoEngineId:"{FFF0E1EB-13DB-4678-B67D-FF0A41DBBCEF}",filter:t},function(t){LoadingBanner&&LoadingBanner.hideLoading();var i=t.bytes,r=t.name,u=new File([i],r);typeof n=="function"&&n(u,t.isCrypto!==!1)})}:null,r=function(n,t){if(!n.publicKey||!n.privateKeyEnc){ASC.Files.UI.displayInfoPanel("Empty encryption keys",!0);return}typeof Teamlab!="undefined"&&Teamlab.setEncryptionKeys({},{update:!!t,publicKey:n.publicKey,privateKeyEnc:n.privateKeyEnc},{error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}})},c=n?function(n,i){Teamlab.getEncryptionAccess({},n,{success:function(r,u){var f=t+ASC.Files.Utility.GetFileDownloadUrl(n);f=f.replace(/action=download/,"action=stream");window.AscDesktopEditor.cloudCryptoCommand("share",{cryptoEngineId:"{FFF0E1EB-13DB-4678-B67D-FF0A41DBBCEF}",file:[f],keys:u},function(n){var t=null,r,u;n.isCrypto!==!1&&(r=n.bytes,u="temp_name",t=new File([r],u));typeof i=="function"&&i(t)})},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0);i()}})}:null;return{init:f,encryptionSupport:e,setAccess:c,encryptionUploadDialog:h}}(),function(n){n(function(){ASC.Desktop&&ASC.Desktop.init()})}(jQuery);
window.ASC.Files.Share=function(){function wt(){v||(ut(),r(),ku(),v=!0)}function bt(){var t=n.$addUserBtn.get(0);return t.classList.contains("disable")?!1:(n.userSelector.resetTempData(),n.userSelector.render(),n.viewSettings.asFlat||(n.userSelector.dialogElement.style.top=t.offsetTop+t.offsetHeight+4+"px"),!0)}function kt(){return n.ownerSelector.resetTempData(),n.ownerSelector.render(),!0}function u(){n.$saveBtnMain.removeClass("display-none");n.$saveBtnArrow.removeClass("display-none");k()}function dt(){n.$saveBtnMain.addClass("display-none");n.$saveBtnArrow.addClass("display-none");k()}function k(){var i,r,t;if(n.viewSettings.displaySettings){i=!1;for(r in n.selected)if(t=n.selected[r],!t.isOwner&&(!t.isLink||t.access!=ASC.Files.Constants.AceStatusEnum.Restrict)){i=!0;break}n.$settingsBtns.toggleClass("disable",!i)}}function gt(){if(!n.$addLinkBtn.hasClass("disable")&&n.viewSettings.externalLinksAvailable){var r=n.targetData.entryData?n.targetData.entryData.id:ASC.Files.UI.parseItemId(n.targetData.id).entryId,f=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(n.targetData.id).entryType,t=n.defaultAccessRight==ASC.Files.Constants.AceStatusEnum.FillForms?ASC.Files.Constants.AceStatusEnum.Read:n.defaultAccessRight==ASC.Files.Constants.AceStatusEnum.ReadWrite?n.viewSettings.canLinkReadWrite?n.defaultAccessRight:ASC.Files.Constants.AceStatusEnum.Read:n.defaultAccessRight,o={isFolder:f==="folder"};Teamlab.getSharedLinkTemplate(r,o,{before:function(){LoadingBanner.displayLoading()},success:function(r,f){var s={id:f.id,link:f.link,linkSettings:f.linkSettings,name:f.title||e.ExternalLink,isLink:!0,canEdit:!0,canRemove:!0,access:t,accessName:i(t),infoText:n.viewSettings.externalLinksAvailable?b(f.link)?e.Shortened:"":e.ExternalLinkDisabled,entryType:f.entryType},c={},o;c[s.id]=s;n.selected=Object.assign(c,n.selected);n.userSelector.changeData(n.selected,n.accessRights,n.defaultAccessRight);o=n.userDomGenerator.createLink(s);o.classList.add("new");n.contentListElement.prepend(o);n.currentElement=o;h(o,!0);n.pagging.contentItemsNumber++;n.$emptyList.hide();u()},after:function(){LoadingBanner.hideLoading()},error:function(n,t){console.log(t)},processUrl:function(n){return ASC.Files.Utility.AddExternalShareKey(n)}})}}function ni(){var i=d(0,n.pagging.renderBy-1),t;n.pagging.searchItemsNumber=i.count;t=n.userDomGenerator.createContentList();t.append(i.fragment);n.searchDialogListParentElement.firstElementChild.replaceWith(t)}function d(t,i){var r={fragment:document.createDocumentFragment(),count:-1},f,u,e;for(f in n.searchResult)if(r.count++,!(r.count<t)){if(r.count>i)break;u=Object.assign({},n.searchResult[f]);u.disabled=n.selected[f]!==undefined;u.selected=u.disabled||n.tmpSelected[f]!==undefined;e=n.userDomGenerator.createGroupItem(u);r.fragment.append(e)}return r.count>i?(r.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore})),r):(r.count++,r.count==0&&r.fragment.append(n.userDomGenerator.createEmptySearchRow()),r)}function ti(){var t=n.$searchInput.position(),i=n.$searchInput.outerHeight();return n.$searchDialog.css("top",t.top+i+4+"px"),!0}function ii(){return n.userSearcher.clear(),!0}function ri(t,i){t.length?(n.searchResult=Object.assign({},i.groups,i.users),ni(),n.searchDialogHelper.show()):n.searchDialogHelper.hide()}function ui(t){var r,o,s,h,c,l,a,f,v;t.classList.contains("disabled")||(r=Object.assign({},n.searchResult[t.id]),o=n.defaultAccessRight,!r.isGroup&&n.userCache[t.id].isVisitor&&(o=n.defaultAccessRightForVisitor),r.access=o,r.accessName=i(o),r.canEdit=!0,r.canRemove=!0,n.selected[t.id]=r,s=n.contentListElement.lastElementChild,h=s&&s.classList.contains("us-show-more-row"),h||(r.isGroup?(c=n.userDomGenerator.createGroup(r),n.contentListElement.append(c)):(r.withoutTitle=n.viewSettings.showTooltop,l=n.userDomGenerator.createGroupItem(r),n.contentListElement.append(l)),n.pagging.contentItemsNumber++,n.$emptyList.hide()),!r.isGroup&&n.openedGroupElement&&(a=n.groupCache[n.openedGroupElement.id].users.indexOf(t.id),a!=-1&&(f=n.openedGroupElement.nextElementSibling.children[t.id],f&&f.classList.contains("us-name")&&(f.querySelector(".us-access").setAttribute("class","us-access access-"+o),v=n.userDomGenerator.createNameInfoText(e.IndividualRights),f.querySelector(".us-name-text").append(v),f.classList.add("info")))),n.searchDialogHelper.hide(),u())}function fi(t){var i=d(n.pagging.searchItemsNumber,n.pagging.searchItemsNumber+n.pagging.renderBy-1);n.pagging.searchItemsNumber=i.count;n.searchDialogListParentElement.firstElementChild.append(i.fragment);t.parentElement.remove()}function s(t,i){i?n.tmpSelected[t]=!0:delete n.tmpSelected[t]}function c(i){if(i==t.none){n.selectionMode=i;n.contentListParentElement.classList.remove("rootonly");n.tmpSelected={};n.openedGroupElement?o(r(n.openedGroupElement.id)):r();return}if(i==t.root){if(n.selectionMode==i)return;n.selectionMode=i;n.contentListParentElement.classList.add("rootonly");n.openedGroupElement=null;r();return}if(i==t.group){if(n.selectionMode==i)return;n.selectionMode=i;n.contentListParentElement.classList.remove("rootonly");o(r(n.openedGroupElement.id))}}function g(i){var l=Object.keys(n.tmpSelected).length,r=l>0,u,s,f,e,c,o,h;if(r||i)n.$actionsContainer.show(),n.$topContentContainer.addClass("hidden"),n.$addUserBtn.addClass("disable"),n.$addLinkBtn.addClass("disable"),n.$addLinkBtnArrow.addClass("disable"),n.$menuActionRemoveBtn.toggle(n.selectionMode!=t.group);else return n.$actionsContainer.hide(),n.$topContentContainer.removeClass("hidden"),n.$addUserBtn.removeClass("disable"),n.$addLinkBtn.removeClass("disable"),n.$addLinkBtnArrow.removeClass("disable"),!1;if(u=!0,s=!0,n.selectionMode==t.root){for(f in n.selected)if((e=n.selected[f],e.canEdit)&&n.tmpSelected[f]===undefined){u=!1;break}for(f in n.tmpSelected)if(e=n.selected[f],!e.canRemove){s=!1;break}}if(n.selectionMode==t.group){c=n.groupCache[n.openedGroupElement.id].users;for(o of c)if(n.userCache[o]&&(h=n.selected[o],h===undefined||h.canEdit)&&n.tmpSelected[o]===undefined){u=!1;break}}return n.$menuActionSelectAllCbx.prop("checked",r&&u),n.$menuActionSelectAllCbx.prop("indeterminate",r&&!u),n.$menuActionChangeBtn.toggleClass("unlockAction",r),n.$menuActionRemoveBtn.toggleClass("unlockAction",r&&s),!0}function ei(i,u){var h,e,c,f,l;if(n.tmpSelected={},u.target.checked){if(h=!0,n.selectionMode==t.group)for(e of n.groupCache[n.openedGroupElement.id].users)n.userCache[e]&&(c=n.selected[e],(c===undefined||c.canEdit)&&s(e,!0));else{for(f in n.selected)n.selected[f].canEdit&&s(f,!0);for(f in n.tmpSelected)if(l=n.selected[f],!l.canRemove){h=!1;break}}n.$menuActionChangeBtn.addClass("unlockAction");n.$menuActionRemoveBtn.toggleClass("unlockAction",h)}else n.$menuActionChangeBtn.removeClass("unlockAction"),n.$menuActionRemoveBtn.removeClass("unlockAction");n.selectionMode==t.group?o(r(n.openedGroupElement.id)):r()}function oi(i,u){var l=u.target.classList.contains("select-all"),b=u.target.classList.contains("select-links"),k=u.target.classList.contains("select-groups"),a=u.target.classList.contains("select-users"),v=u.target.getAttribute("data-access")===null,y=+u.target.getAttribute("data-access"),e,h,p,c,f,w;if(n.selectionMode==t.group){for(e of n.groupCache[n.openedGroupElement.id].users)if(n.userCache[e]&&(h=n.selected[e],h===undefined||h.canEdit)){if(v){s(e,l||a);continue}p=h===undefined?n.selected[n.openedGroupElement.id].access:h.access;s(e,p==y)}}else for(c in n.selected)(f=n.selected[c],f.canEdit)&&(w=v?l||f.isLink&&b||f.isGroup&&k||!f.isLink&&!f.isGroup&&a:f.access==y,s(c,w));g(!0);n.selectionMode==t.group?o(r(n.openedGroupElement.id)):r();n.menuSelectDialogHelper.hide()}function si(){var t,i,r;if(!n.$menuActionChangeBtn.hasClass("unlockAction"))return!1;n.currentElement=null;var u=!0,f=!0,e=!1,o=!1;for(t in n.tmpSelected){if(i=n.selected[t],i&&i.isLink){u=n.viewSettings.canLinkReadWrite;f=!1;o=!n.viewSettings.externalLinksAvailable;continue}r=n.userCache[t];r&&r.isVisitor&&(e=!0)}return ft(n.$menuAccessRightsDialog,u,f,!1,e,o),!0}function hi(){var t,i;n.currentElement=null;for(t in n.tmpSelected)(i=n.selected[t],i.canRemove)&&(i.isLink?y(t):delete n.selected[t]);l()}function l(){n.$actionsContainer.hide();n.$topContentContainer.removeClass("hidden");n.$addUserBtn.removeClass("disable");n.$addLinkBtn.removeClass("disable");n.$addLinkBtnArrow.removeClass("disable");c(t.none)}function ci(t){n.viewSettings.externalLinksAvailable&&f(t,n.linkPasswordDialogHelper,n.$linkPasswordDialog)}function li(t){n.viewSettings.externalLinksAvailable&&f(t,n.linkLifetimeDialogHelper,n.$linkLifetimeDialog)}function ai(t){n.$linkActionDialog.find("li:not(:last-of-type)").toggle(n.viewSettings.externalLinksAvailable);f(t,n.linkActionDialogHelper,n.$linkActionDialog)}function f(t,i,r,u){var e,o;if(t&&n.currentElement==t&&r.is(":visible")){r.hide();return}i.hide();n.currentElement=t;var s=u===undefined?4:u,h=n.$contentListParent.outerHeight(),f=n.$contentListParent.scrollTop(),c=jq(t),l=c.position(),v=c.outerHeight(),a=f+l.top+v-s;r.css("top",a+"px");setTimeout(function(){i.show()},0);e=r.outerHeight();h+f<a+e&&(o=f+l.top+s-e,o<f?r.css("top",h+f-e+"px"):r.css("top",o+"px"))}function vi(t,i){var u=n.currentElement.id,r=i.target.classList;r.contains("link-action-share")?(f(n.currentElement,n.linkShareDialogHelper,n.$linkShareDialog),n.$linkShareDialogInput.trigger("focus").trigger("select")):r.contains("link-action-embed")?(f(n.currentElement,n.linkEmbedDialogHelper,n.$linkEmbedDialog),n.$linkEmbedDialogInput.trigger("focus").trigger("select")):r.contains("link-action-short")?st():r.contains("link-action-password")?f(n.currentElement,n.linkPasswordDialogHelper,n.$linkPasswordDialog):r.contains("link-action-lifetime")?f(n.currentElement,n.linkLifetimeDialogHelper,n.$linkLifetimeDialog):r.contains("link-action-rename")?h(n.currentElement,!0):r.contains("link-action-delete")&&f(n.currentElement,n.linkDeleteDialogHelper,n.$linkDeleteDialog);n.linkActionDialogHelper.hide()}function h(t,i){var e=t.querySelector(".us-name-text"),r=t.querySelector(".us-rename"),f,u;i?(t.classList.add("rename"),f=!1,r?r.style.display="flex":(r=n.userDomGenerator.createLinkRenameBlock(),e.after(r),f=!0),u=r.querySelector(".textEdit"),f&&u.addEventListener("keyup",function(n){n.keyCode===27&&(n.stopPropagation(),h(t,!1));n.keyCode===13&&(n.stopPropagation(),nt(t))}),u.value=n.selected[t.id].name,u.focus()):t.classList.contains("new")?(n.currentElement=t,y(t.id)):(t.classList.remove("rename"),r.remove())}function nt(t){var i,r;t.classList.remove("new");i=t.querySelector(".textEdit").value;i&&(r=t.querySelector(".us-name-text span"),r.setAttribute("title",i),r.textContent=i,n.selected[t.id].name!=i&&(n.selected[t.id].name=i,u()));h(t,!1)}function y(t){if(t===ASC.Files.Constants.ShareLinkId){var r=n.selected[t];r.access=ASC.Files.Constants.AceStatusEnum.Restrict;r.accessName=i(ASC.Files.Constants.AceStatusEnum.Restrict);r.canEdit=!1;r.canRemove=!1}else delete n.selected[t];p()}function p(){n.currentElement&&(n.currentElement.remove(),n.pagging.contentItemsNumber--,n.$emptyList.toggle(n.pagging.contentItemsNumber==0));u()}function yi(t){var t=t.parentElement,r=t.getAttribute("data-group"),i;r==null?(i=rt(r,n.pagging.contentItemsNumber,n.pagging.contentItemsNumber+n.pagging.renderBy-1),n.pagging.contentItemsNumber=i.count,n.contentListElement.append(i.fragment)):(i=it(r,n.pagging.usersItemsNumber,n.pagging.usersItemsNumber+n.pagging.renderBy-1),n.pagging.usersItemsNumber=i.count,t.parentElement.append(i.fragment));t.remove()}function pi(){var t,i,f,e;if(n.targetData.ownerIdTmp&&n.selected[n.targetData.ownerIdTmp]||(n.targetData.ownerIdTmp=n.targetData.ownerId),t={},t[n.targetData.ownerIdTmp]=n.selected[n.targetData.ownerIdTmp],n.ownerSelector)n.ownerSelector.changeData(t);else{i={};for(f in n.userCache)e=n.userCache[f],e.isVisitor||(i[f]=e);n.ownerSelector=new UserSelector({userCache:i,groupCache:n.groupCache,selected:t,userDomGenerator:n.userDomGenerator,singleChoice:!0,groupSelection:!1,onSave:function(t){for(var e in t){var i=t[e],f=n.selected[n.targetData.ownerIdTmp],o=Object.assign({},f,{id:i.id,name:i.name,avatar:i.avatar});delete n.selected[f.id];n.selected[i.id]=o;n.targetData.ownerIdTmp=i.id}r();u()}});n.$topContentContainer.append(n.ownerSelector.dialogElement);n.ownerSelector.dialogElement.style.top="90px";n.ownerSelectorDialogHelper=new DialogHelper(null,n.ownerSelector.dialogElement,kt,null,!1,!0);n.ownerSelector.onCancel=n.ownerSelectorDialogHelper.hide}n.ownerSelectorDialogHelper.show()}function wi(t,i){if(!i.target.classList.contains("uneditable")){var r=t.classList.contains("us-linkname")||t.classList.contains("us-folder-linkname"),o=r?n.viewSettings.canLinkReadWrite:!0,s=!r,u=n.userCache[t.id],h=u&&u.isVisitor,c=r&&!n.viewSettings.externalLinksAvailable,e=n.selected[t.id],l=e&&e.canRemove&&!t.getAttribute("data-group");ft(n.$itemAccessRightsDialog,o,s,l,h,c);f(t,n.itemAccessRightsDialogHelper,n.$itemAccessRightsDialog)}}function bi(r){var w=r.getAttribute("data-id"),b,k,y,p,d,a,g,nt,c,l;if(w=="remove"){ki(r);return}var s=+w,h=i(s),f=n.currentElement.id,tt=n.currentElement.classList.contains("us-groupname"),it=n.currentElement.classList.contains("us-linkname")||n.currentElement.classList.contains("use-folder-linkname"),v=n.currentElement.querySelector(".us-access"),rt=v.classList.contains("static");v.setAttribute("class","us-access access-"+s+(rt?" static":""));v.setAttribute("title",h);tt?(n.selected[f].access=s,n.selected[f].accessName=h,o(n.currentElement,!0)):it?(n.selected[f].access=s,n.selected[f].accessName=h):(b=n.currentElement.getAttribute("data-group"),b?n.selected[f]!==undefined?(n.selected[f].access=s,n.selected[f].accessName=h,c=n.contentListElement.children[f],c&&c.classList.contains("us-name")&&(l=c.querySelector(".us-access"),l.setAttribute("class","us-access access-"+s),l.setAttribute("title",h))):(k=n.userDomGenerator.createNameInfoText(e.IndividualRights),n.currentElement.querySelector(".us-name-text").append(k),n.currentElement.classList.add("info"),y=n.userCache[f],n.selected[f]={id:f,name:y.displayName,avatar:y.avatarSmall,access:s,accessName:h,canEdit:!0,canRemove:!0},p=n.contentListElement.lastElementChild,d=p&&p.classList.contains("us-show-more-row"),d||(a=Object.assign({},n.selected[f]),a.selected=!1,a.disabled=n.selectionMode==t.group,a.withoutTitle=n.viewSettings.showTooltop,g=n.userDomGenerator.createGroupItem(a),n.contentListElement.append(g),n.pagging.contentItemsNumber++)):(n.selected[f].access=s,n.selected[f].accessName=h,n.openedGroupElement&&(nt=n.groupCache[n.openedGroupElement.id].users.indexOf(f),nt!=-1&&(c=n.openedGroupElement.nextElementSibling.children[f],c&&c.classList.contains("us-name")&&(l=c.querySelector(".us-access"),l.setAttribute("class","us-access access-"+s),l.setAttribute("title",h))))));u();n.itemAccessRightsDialogHelper.hide()}function ki(){var i=n.currentElement.id,o=n.currentElement.classList.contains("us-groupname"),s=n.currentElement.classList.contains("us-linkname")||n.currentElement.classList.contains("us-folder-linkname"),e,t,r,u;o?(n.currentElement==n.openedGroupElement&&(n.openedGroupElement=null),delete n.selected[i],p()):s?f(n.currentElement,n.linkDeleteDialogHelper,n.$linkDeleteDialog):(n.openedGroupElement&&(e=n.groupCache[n.openedGroupElement.id].users.indexOf(i),e!=-1&&(t=n.openedGroupElement.nextElementSibling.children[i],t&&t.classList.contains("us-name")&&(r=n.selected[n.openedGroupElement.id],u=t.querySelector(".us-access"),u.setAttribute("class","us-access access-"+r.access),u.setAttribute("title",r.accessName),t.classList.remove("info")))),delete n.selected[i],p());n.itemAccessRightsDialogHelper.hide()}function di(t){var u=+t.getAttribute("data-id"),r,f,e;for(r in n.tmpSelected)f=n.selected[r],f?(f.access=u,f.accessName=i(u)):(e=n.userCache[r],n.selected[r]={id:r,name:e.displayName,avatar:e.avatarSmall,access:u,accessName:i(u),canEdit:!0,canRemove:!0});l();n.menuAccessRightsDialogHelper.hide()}function gi(i){var u,f,e,h;i.classList.contains("unselectable")||(u=n.selected[i.id],f=u===undefined||u.canEdit,f&&(e=i.classList.toggle("selected"),s(i.id,e)),i.classList.contains("us-groupname")||i.classList.contains("us-linkname")||i.classList.contains("us-folder-linkname")?c(t.root):(h=i.getAttribute("data-group"),h===null?c(t.root):c(t.group)),g(!f)||(n.selectionMode=t.none,n.contentListParentElement.classList.remove("rootonly"),n.openedGroupElement?o(r(n.openedGroupElement.id)):r()))}function nr(i){n.selectionMode==t.root||i.classList.contains("unopenable")||o(i)}function tt(i,r){n.selectionMode==t.root||(r.target.classList.contains("us-settings-password")?ci(i,r):r.target.classList.contains("us-settings-lifetime")?li(i,r):r.target.classList.contains("textEdit")||(r.target.classList.contains("__apply")?nt(i):r.target.classList.contains("__reset")?h(i,!1):ai(i,r)))}function tr(){}function o(t,i){t&&!t.classList.contains("unopenable")&&(t!=n.openedGroupElement||i?(n.openedGroupElement&&(n.openedGroupElement.parentElement.classList.remove("opened"),t.id!=n.openedGroupElement.id&&(n.pagging.usersItemsNumber=0)),ir(t.nextElementSibling,t.id),t.parentElement.classList.add("opened"),n.openedGroupElement=t):t.parentElement.classList.toggle("opened"))}function ir(t,i){var u=it(i,0,Math.max(n.pagging.usersItemsNumber,n.pagging.renderBy)-1),r;n.pagging.usersItemsNumber=u.count;r=n.userDomGenerator.createGroupItems();r.append(u.fragment);t.replaceWith(r)}function it(r,u,f){var o={fragment:document.createDocumentFragment(),count:-1},y=n.selected[r].access,p=i(y),w=n.groupCache[r].users,h,c,v,l,s;for(h of w)if((c=n.userCache[h],c)&&(o.count++,!(o.count<u))){if(o.count>f)break;v=n.tmpSelected[h]!==undefined;l=n.selected[h];l?(s=Object.assign({},l),s.group=r,s.selected=v,s.disabled=n.selectionMode==t.group&&!l.canEdit,s.withoutTitle=n.viewSettings.showTooltop,s.infoText=e.IndividualRights,o.fragment.append(n.userDomGenerator.createGroupItem(s))):(s={id:h,group:r,name:c.displayName,avatar:c.avatarSmall,selected:v,access:y,accessName:p},s.withoutTitle=n.viewSettings.showTooltop,o.fragment.append(n.userDomGenerator.createGroupItem(s)))}return o.count>f?(o.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore,group:r})),o):(o.count++,o)}function r(t){var r=rt(t,0,Math.max(n.pagging.contentItemsNumber,n.pagging.renderBy)-1),i;return n.pagging.contentItemsNumber=r.count,i=n.userDomGenerator.createContentList(),i.append(r.fragment),n.contentListElement.replaceWith(i),n.contentListElement=i,n.$emptyList.toggle(n.pagging.contentItemsNumber==0),r.outGroupElement}function rt(i,r,u){var o={fragment:document.createDocumentFragment(),count:-1,outGroupElement:null},c=n.selectionMode==t.group,y=n.selectionMode==t.root,s,f,l,h,v;for(s in n.selected)if((f=Object.assign({},n.selected[s]),!f.isLink||f.canEdit||f.inherited)&&(o.count++,!(o.count<r))){if(o.count>u)break;f.selected=!c&&n.tmpSelected[s]!=undefined;f.disabled=c||y&&!f.canEdit;f.isLink?(f.infoText=n.viewSettings.externalLinksAvailable?b(f.link)?e.Shortened:"":e.ExternalLinkDisabled,l=n.userDomGenerator.createLink(f),o.fragment.append(l)):f.isGroup?(h=n.userDomGenerator.createGroup(f),s==i&&(o.outGroupElement=h.querySelector(".us-name")),o.fragment.append(h)):(f.withoutTitle=n.viewSettings.showTooltop,v=n.userDomGenerator.createGroupItem(f),o.fragment.append(v))}return o.count>u?(o.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore})),o):(o.count++,o)}function ut(){function t(t){var i=n.userDomGenerator.createAccessRightsImgDialogContent(n.accessRights);n.userDomGenerator.clearElement(t);t.append(i)}function i(t){var i=n.userDomGenerator.createAccessRightsDialogContent(n.accessRights);t.replaceWith(i)}t(n.$menuAccessRightsDialog.get(0));t(n.$itemAccessRightsDialog.get(0));i(n.$menuSelectDialog.find(".dropdown-content:last").get(0))}function ft(t,i,r,u,f,e){var o,s;for(o of n.accessRights)if(!o.disabled){if(e&&o.id!=ASC.Files.Constants.AceStatusEnum.Restrict){t.find(".access-rights-item[data-id="+o.id+"]").hide();continue}s=!(o.hideForVisitor&&f)&&(o.id==ASC.Files.Constants.AceStatusEnum.ReadWrite?i:!0)&&(o.id==ASC.Files.Constants.AceStatusEnum.FillForms?r:!0);t.find(".access-rights-item[data-id="+o.id+"]").toggle(s)}t.find(".dropdown-item-seporator, .access-rights-item[data-id=remove]").toggle(u)}function rr(){var t;if(n.$addLinkBtnArrow.hasClass("disable"))return!1;var i=n.$addLinkBtnArrow.position(),r=n.$addLinkBtnArrow.outerHeight(),u=n.$addLinkBtnArrow.outerWidth(),f=n.$addLinkActionDialog.outerWidth();return n.$addLinkActionDialog.css("top",i.top+r+4+"px"),t=i.left+u-f,n.$addLinkActionDialog.css("left",(t>0?t:0)+"px"),!0}function ur(){n.addLinkActionDialogHelper.hide();jq(this).is(n.$addLinkActionDialogNew)&&n.$addLinkBtn.trigger("click")}function fr(){n.saveActionDialogHelper.hide();var t=jq(this);if(t.is(n.$saveActionDialogMessage)){n.messageDialogHelper.show();return}if(t.is(n.$saveActionDialogSilent)){n.save(!1,"");return}if(t.is(n.$saveActionDialogCopy)){n.save(!0,"");return}}function er(){return n.$settingsBtns.hasClass("disable")?!1:(n.$advancedSettingsDialogDenyDownloadCbx.prop("disabled",!1),n.$advancedSettingsDialogDenyDownloadLabel.removeClass("gray-text").show(),n.$advancedSettingsDialogDenySharingCbx.prop("disabled",!1),n.$advancedSettingsDialogDenySharingLabel.removeClass("gray-text").show(),(n.viewSettings.rootFolderTypeCommon||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate")&&(n.viewSettings.denySharing=!1,n.$advancedSettingsDialogDenySharingCbx.prop("disabled",!0),n.$advancedSettingsDialogDenySharingLabel.addClass("gray-text").hide()),n.targetData.encrypted&&(n.viewSettings.denyDownload=!1,n.$advancedSettingsDialogDenyDownloadCbx.prop("disabled",!0),n.$advancedSettingsDialogDenyDownloadLabel.addClass("gray-text").hide()),n.$advancedSettingsDialogDenyDownloadCbx.prop("checked",n.viewSettings.denyDownload),n.$advancedSettingsDialogDenySharingCbx.prop("checked",n.viewSettings.denySharing),!0)}function or(){return pr(),ot(!1),wr(),br(),kr()}function sr(){return hr(),et(),n.$linkShareDialogSocialContainer.find(".facebook, .twitter").toggle(n.$linkSettingsInput.data("social")),!0}function hr(){n.viewSettings.hasMailAccounts===undefined&&window.Teamlab.getAccounts({},{success:function(t,i){n.viewSettings.hasMailAccounts=i&&i.length?i.some(function(n){return n.enabled&&!n.isGroup}):!1},error:function(t,i){n.viewSettings.hasMailAccounts=!1;console.log(i)}})}function et(){var t=n.selected[n.currentElement.id].link,r=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(n.targetData.id).entryType,i;n.$linkShareDialogInput.val(t);i=encodeURIComponent(t);ASC.Resources.Master.UrlShareFacebook?n.$linkShareDialogSocialContainer.find(".facebook").attr("href",ASC.Resources.Master.UrlShareFacebook.format(i,encodeURIComponent(n.viewSettings.title),"","")):n.$linkShareDialogSocialContainer.find(".facebook").remove();ASC.Resources.Master.UrlShareTwitter?n.$linkShareDialogSocialContainer.find(".twitter").attr("href",ASC.Resources.Master.UrlShareTwitter.format(i)):n.$linkShareDialogSocialContainer.find(".twitter").remove();var u=r==="file"?ASC.Files.FilesJSResource.shareLinkMailSubject.format(n.viewSettings.title):ASC.Files.FilesJSResource.shareFolderLinkMailSubject.format(n.viewSettings.title),f=r==="file"?ASC.Files.FilesJSResource.shareLinkMailBody.format(n.viewSettings.title,t):ASC.Files.FilesJSResource.shareFolderLinkMailBody.format(n.viewSettings.title,t);n.$linkShareDialogSocialContainer.find(".mail").attr("href","mailto:?subject={1}&body={0}".format(encodeURIComponent(f),encodeURIComponent(u)))}function cr(){return w(),!0}function lr(t){var f=t.getAttribute("href"),e=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(n.targetData.id).entryType,i,r;if(t.classList.contains("mail")&&!ASC.Resources.Master.Personal){if(n.viewSettings.hasMailAccounts===!1)return!0;i=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER);r=new ASC.Mail.Message;r.subject=e==="file"?ASC.Files.FilesJSResource.shareLinkMailSubject.format(n.viewSettings.title):ASC.Files.FilesJSResource.shareFolderLinkMailSubject.format(n.viewSettings.title);var o='<a href="{0}">{1}<\/a>',u=n.selected[n.currentElement.id].link,s=o.format(Encoder.htmlEncode(u),Encoder.htmlEncode(n.viewSettings.title)),h=o.format(Encoder.htmlEncode(u),Encoder.htmlEncode(u)),c=e==="file"?ASC.Files.FilesJSResource.shareLinkMailBody.format(s,h):ASC.Files.FilesJSResource.shareFolderLinkMailBody.format(s,h);return r.body=c,ASC.Mail.Utility.SaveMessageInDrafts(r).done(function(n,t){var r=t.messageUrl;i&&i.location?i.location.href=r:i=window.open(r,"_blank")}).fail(function(){i.close();window.location.href=f}),!1}return window.open(f,"new","height=600,width=1020,fullscreen=0,resizable=0,status=0,toolbar=0,menubar=0,location=1"),!1}function w(){var r=jq(this),t,i;r.is(".embed-size-item")&&(r.hasClass("embed-size-6x8")?(n.$linkEmbedDialogSizeCustomWidth.val("600px"),n.$linkEmbedDialogSizeCustomHeight.val("800px")):r.hasClass("embed-size-4x6")?(n.$linkEmbedDialogSizeCustomWidth.val("400px"),n.$linkEmbedDialogSizeCustomHeight.val("600px")):(n.$linkEmbedDialogSizeCustomWidth.val("100%"),n.$linkEmbedDialogSizeCustomHeight.val("100%")));t=n.$linkEmbedDialogSizeCustomWidth.val();i=n.$linkEmbedDialogSizeCustomHeight.val();t=(/\d+(px|%)?/gim.exec(t.toLowerCase().trim())||["100%"])[0];t==Math.abs(t)&&(t+="px");i=(/\d+(px|%)?/gim.exec(i.toLowerCase().trim())||["100%"])[0];i==Math.abs(i)&&(i+="px");n.$linkEmbedDialogSizeCustomWidth.val(t);n.$linkEmbedDialogSizeCustomHeight.val(i);jq(".embed-size-item").removeClass("selected");t=="600px"&&i=="800px"?jq(".embed-size-6x8").addClass("selected"):t=="400px"&&i=="600px"?jq(".embed-size-4x6").addClass("selected"):t=="100%"&&i=="100%"&&jq(".embed-size-1x1").addClass("selected");ar(t,i)}function ar(t,i){t=t||"100%";i=i||"100%";var u=n.selected[n.currentElement.id].link,r="";ASC.Files.Utility.CanWebView(n.viewSettings.title)?(r='<iframe src="{0}" width="{1}" height="{2}" frameborder="0" scrolling="no" allowtransparency><\/iframe>',u=u+"&action=embedded"):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(n.viewSettings.title)&&(r='<img src="{0}" width="{1}" height="{2}" alt="" />');r=r.format(u,t,i);n.$linkEmbedDialogInput.val(r).attr("title",r)}function ot(t){var r=n.selected[n.currentElement.id],i=b(r.link),u;n.$linkActionDialogShort.toggle(!i);n.$linkShareDialogShort.toggle(!i);t&&i?(r.infoText=e.Shortened,u=n.userDomGenerator.createLink(r),n.currentElement.replaceWith(u)):n.currentElement.classList.toggle("info",i||!n.viewSettings.externalLinksAvailable)}function b(n){return n?!new RegExp("/Products/Files/","i").test(n):!1}function st(){var t=n.targetData.entryData?n.targetData.entryData.id:ASC.Files.UI.parseItemId(n.targetData.id).entryId,i=n.currentElement.id,r=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(n.targetData.id).entryType,u=r!=="file";ASC.Files.ServiceManager.getShortenLink(ASC.Files.ServiceManager.events.GetShortenLink,{fileId:t,linkId:i,isFolder:u})}function vr(t,i,r){if(!t||typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.OperationFailedMsg,!0);return}n.selected[n.currentElement.id].link=t;et();ot(!0);yr(t)?ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess):ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.OperationSuccededMsg)}function yr(n){var t=document.createElement("input");t.setAttribute("type","text");t.setAttribute("value",n);t=document.body.appendChild(t);t.select();try{return document.execCommand("copy")}catch(i){return!1}finally{t.remove()}}function pr(){var t=ASC.Files.Utility.CanWebView(n.viewSettings.title)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(n.viewSettings.title);n.$linkActionDialogEmbed.toggle(t)}function wr(){var i=n.selected[n.currentElement.id],t=n.viewSettings.externalLinksAvailable&&!!i.linkSettings&&!i.inherited;n.$linkActionDialog.find(".dropdown-item-seporator:first").toggle(t);n.$linkActionDialogPassword.toggle(t);n.$linkActionDialogLifetime.toggle(t);n.$linkActionDialogRename.toggle(t)}function br(){var t=n.selected[n.currentElement.id];n.$linkActionDialog.find(".dropdown-item-seporator:last").toggle(!t.inherited&&n.viewSettings.externalLinksAvailable);n.$linkActionDialogDelete.parent().toggle(!t.inherited)}function kr(){return n.$linkActionDialog.find("li").filter(function(n,t){return t.style.display!=="none"}).length>0}function ht(){return this.select(),!1}function ct(n){return n.ctrlKey&&(n.charCode===ASC.Files.Common.keyCode.C||n.keyCode===ASC.Files.Common.keyCode.insertKey)}function lt(n,t){n.classList.contains("disabled")||t.find(".textEdit, .textEditCalendar").val("")}function at(n,t){t.find(".textEdit, .textEditCalendar, .autodelete").prop("disabled",n);t.find(".img-btn, .link").toggleClass("disabled",n)}function dr(){var t=n.selected[n.currentElement.id].linkSettings;return n.$linkPasswordDialogInput.attr("type","password").val(t.password||""),n.$linkPasswordDialogShow.removeClass("hide"),n.$linkPasswordDialogCbx.prop("checked",!!t.password).change(),!0}function gr(){if(!n.$linkPasswordDialogShow.hasClass("disabled")){if(n.$linkPasswordDialogShow.hasClass("hide")){n.$linkPasswordDialogInput.attr("type","password");n.$linkPasswordDialogShow.removeClass("hide");return}n.$linkPasswordDialogInput.attr("type","text");n.$linkPasswordDialogShow.addClass("hide")}}function nu(){n.$linkPasswordDialogRandom.hasClass("disabled")||Teamlab.getRandomPassword(null,{before:function(){LoadingBanner.displayLoading()},success:function(t,i){n.$linkPasswordDialogInput.attr("type","text").val(i);n.$linkPasswordDialogShow.addClass("hide")},after:function(){LoadingBanner.hideLoading()},error:function(n,t){console.log(t)}})}function tu(){var t=null,i,r;(n.$linkPasswordDialogCbx.prop("checked")&&(t=n.$linkPasswordDialogInput.val().trim()||null),i=n.selected[n.currentElement.id].linkSettings,i.password!=t)&&(i.password=t,r=n.currentElement.querySelector(".us-settings-password"),r.classList.toggle("enabled",t),u())}function iu(){var t=n.selected[n.currentElement.id].linkSettings,i;return t.expirationDate?(i=new Date(t.expirationDate),n.$linkLifetimeDialogDateInput.val(jQuery.datepicker.formatDate(ASC.Resources.Master.DatepickerDatePattern,i)),n.$linkLifetimeDialogTimeInput.val(i.toLocaleTimeString("en-US",{hourCycle:"h23"}).substring(0,5))):(n.$linkLifetimeDialogDateInput.val(""),n.$linkLifetimeDialogTimeInput.val("")),n.$linkLifetimeDialogDateInput.removeClass("error"),n.$linkLifetimeDialogTimeInput.removeClass("error"),n.$linkLifetimeDialogCbx.prop("checked",!!t.expirationDate).change(),n.$linkLifetimeDialogAutodeleteCbx.prop("checked",!!t.autoDelete),!0}function ru(){var o=!1,r=null,f=!1,t,h,c,e,i,s;if(n.$linkLifetimeDialogCbx.prop("checked")){if(t=n.$linkLifetimeDialogDateInput.datepicker("getDate"),h=n.$linkLifetimeDialogDateInput.val().trim(),!t||!jq.isDateFormat(h)){n.$linkLifetimeDialogDateInput.addClass("error");return}o=n.$linkLifetimeDialogAutodeleteCbx.prop("checked");c=n.$linkLifetimeDialogTimeInput.val().trim();e=c.split(":");t.setHours(e[0]);t.setMinutes(e.length>1?e[1]:0);r=ServiceFactory.serializeTimestamp(t);var l=new Date,a=new Date(l.getTime()+l.getTimezoneOffset()*6e4),v=new Date(a.getTime()+ASC.Resources.Master.CurrentTenantTimeZone.UtcOffset*6e4);if(f=v>t,f){n.$linkLifetimeDialogDateInput.addClass("error");n.$linkLifetimeDialogTimeInput.addClass("error");return}}if(i=n.selected[n.currentElement.id].linkSettings,i.expirationDate==r&&i.autoDelete==o){n.linkLifetimeDialogHelper.hide();return}i.autoDelete=o;i.expirationDate=r;i.expired=f;s=n.currentElement.querySelector(".us-settings-lifetime");s.classList.toggle("enabled",r);s.classList.toggle("warning",f);n.linkLifetimeDialogHelper.hide();u()}function uu(){if(!ASC.Clipboard.enable){n.$addLinkActionDialogCopy.parent().remove();n.$linkActionDialogCopy.remove();n.$linkShareDialogCopy.remove();n.$linkEmbedDialogCopy.remove();n.$saveActionDialogCopyParent.remove();n.$saveActionDialogSeporator.remove();n.$linkPasswordDialogCopy.remove();return}n.clipboard.directLink=ASC.Clipboard.createManually(n.$addLinkActionDialogCopy.get(0),{text:function(){return window.location.protocol+"//"+window.location.hostname+n.targetData.entryLink}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.internalLink=ASC.Clipboard.createManually(n.$saveActionDialogCopy.get(0),{text:function(){return window.location.protocol+"//"+window.location.hostname+n.targetData.entryLink}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkAction=ASC.Clipboard.createManually(n.$linkActionDialogCopy.get(0),{text:function(){return n.selected[n.currentElement.id].link}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkShare=ASC.Clipboard.createManually(n.$linkShareDialogCopy.get(0),{text:function(){return n.selected[n.currentElement.id].link}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkEmbed=ASC.Clipboard.createManually(n.$linkEmbedDialogCopy.get(0),{target:function(){return n.$linkEmbedDialogInput.get(0)}},function(){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.CodeCopySuccess)});n.clipboard.externalLinkPassword=ASC.Clipboard.createManually(n.$linkPasswordDialogCopy.get(0),{text:function(){return n.$linkPasswordDialogCopy.hasClass("disabled")?!1:"link: "+n.selected[n.currentElement.id].link+"\npassword: "+n.$linkPasswordDialogInput.val()}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)})}function fu(t,i,r,u){var o=Array.isArray(t),f,s,e;if(n.targetData.id=o&&t.length==1?t[0]:t,n.targetData.sharingInfo=null,n.targetData.ownerId=null,n.targetData.multiple=Array.isArray(n.targetData.id),n.targetData.encrypted=!1,n.targetData.entryData=null,n.targetData.entryLink=null,n.targetData.isThirdparty=r?u:!1,n.targetData.multiple){ASC.Files.ThirdParty&&(n.targetData.isThirdparty=t.some(function(n){var t=ASC.Files.UI.parseItemId(n),i=ASC.Files.UI.getEntryObject(t.entryType,t.entryId),r=ASC.Files.UI.getObjectData(i);return ASC.Files.ThirdParty.isThirdParty(r)}));return}f=ASC.Files.UI.parseItemId(o?t[0]:t);s=ASC.Files.UI.getEntryObject(f.entryType,f.entryId);n.targetData.entryData=ASC.Files.UI.getObjectData(s);n.targetData.entryData?(n.targetData.encrypted=n.targetData.entryData.encrypted,n.targetData.isThirdparty=ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(n.targetData.entryData)):r===!0&&ASC.Desktop&&ASC.Desktop.setAccess&&(n.targetData.encrypted=!0);n.targetData.encrypted||(e=ASC.Files.UI.getEntryLink(f.entryType,f.entryId,o?i[0]:i),n.targetData.entryLink=e.indexOf(ASC.Files.Constants.URL_BASE)>-1?e:ASC.Files.Constants.URL_BASE+e)}function eu(t,i,r,u,f,e,o){var h=Array.isArray(t),c,s;n.viewSettings.title=n.targetData.multiple?t.length.toString():n.targetData.entryData?n.targetData.entryData.title:h?i[0]:i;n.viewSettings.asFlat=r;n.viewSettings.showTooltop=!r&&!ASC.Desktop;n.viewSettings.rootFolderTypeCommon=u;n.viewSettings.notifyAvailable=!u&&(!ASC.Files.Folders||ASC.Files.Folders.folderContainer=="my"||ASC.Files.Folders.folderContainer=="forme"||ASC.Files.Folders.folderContainer=="privacy");n.viewSettings.externalLinksAvailable=!1;n.viewSettings.originForPost=r&&f?f:"*";n.viewSettings.displaySettings=!n.targetData.isThirdparty;n.viewSettings.denyDownload=r?e:n.targetData.entryData?n.targetData.entryData.deny_download:!1;n.viewSettings.denySharing=r?o:n.targetData.entryData?n.targetData.entryData.deny_sharing:!1;n.viewSettings.canWebCustomFilterEditing=!1;n.viewSettings.canWebReview=!1;n.viewSettings.canWebRestrictedEditing=!1;n.viewSettings.canWebComment=!1;n.viewSettings.canLinkReadWrite=!1;n.targetData.multiple?(n.viewSettings.canWebCustomFilterEditing=!0,n.viewSettings.canWebReview=!0,n.viewSettings.canWebRestrictedEditing=!0,n.viewSettings.canWebComment=!0,i.forEach(function(i,r){return ASC.Files.UI.parseItemId(t[r]).entryType=="folder"?(n.viewSettings.displaySettings=n.viewSettings.canWebCustomFilterEditing=n.viewSettings.canWebReview=n.viewSettings.canWebRestrictedEditing=n.viewSettings.canWebComment=!1,!1):(ASC.Files.Utility.CanWebCustomFilterEditing(i)||(n.viewSettings.canWebCustomFilterEditing=!1),ASC.Files.Utility.CanWebReview(i)||(n.viewSettings.canWebReview=!1),ASC.Files.Utility.CanWebRestrictedEditing(i)||(n.viewSettings.canWebRestrictedEditing=!1),ASC.Files.Utility.CanWebComment(i)||(n.viewSettings.canWebComment=!1),ASC.Files.Utility.CanWebView(i)||(n.viewSettings.displaySettings=!1),n.viewSettings.canWebCustomFilterEditing||n.viewSettings.canWebReview||n.viewSettings.canWebRestrictedEditing||n.viewSettings.canWebComment)}),(n.targetData.isThirdparty||ASC.Files.Folders.folderContainer=="privacy")&&(n.viewSettings.canWebRestrictedEditing=!1)):(c=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(h?t[0]:t).entryType,s=n.viewSettings.title,c=="file"?(n.viewSettings.canWebCustomFilterEditing=ASC.Files.Utility.CanWebCustomFilterEditing(s),n.viewSettings.canWebReview=ASC.Files.Utility.CanWebReview(s),n.viewSettings.canWebRestrictedEditing=ASC.Files.Utility.CanWebRestrictedEditing(s),n.viewSettings.canWebComment=ASC.Files.Utility.CanWebComment(s),n.viewSettings.canLinkReadWrite=ASC.Files.Utility.CanWebEdit(s)&&!ASC.Files.Utility.MustConvert(s),n.viewSettings.displaySettings=n.viewSettings.displaySettings&&ASC.Files.Utility.CanWebView(s),n.targetData.isThirdparty&&(n.viewSettings.canWebRestrictedEditing=!1)):(n.viewSettings.canLinkReadWrite=!0,n.viewSettings.displaySettings=!1))}function ou(t,i,r,u,f,e,o,s,h){fu(t,i,r,s);eu(t,i,r,u,f,e,o);var c={entry:n.targetData.multiple?t:[t]};ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetSharedInfo,{showLoading:!0,defaultAccessRights:h},{stringList:c})}function su(t){n.targetData.sharingInfo=t;n.targetData.needUpdate=!1;n.viewSettings.externalLinksAvailable=n.$linkSettingsInput.data("available");var r={};return t.forEach(function(t){if(t.id===ASC.Files.Constants.ShareLinkId||t.linkSettings){n.targetData.encrypted=!1;var u=t.id===ASC.Files.Constants.ShareLinkId?t.ace_status!=ASC.Files.Constants.AceStatusEnum.Restrict:!t.inherited;r[t.id]={id:t.id,link:t.link,linkSettings:t.linkSettings?Object.assign({},t.linkSettings):t.linkSettings,name:t.title||e.QuickExternalLink,isLink:!0,canEdit:u,canRemove:u,access:t.ace_status,accessName:i(t.ace_status),entryType:t.entryType,inherited:t.inherited}}else t.id!==ASC.Files.Constants.GUEST_USER_ID&&(t.is_group?r[t.id]={id:t.id,name:t.title,isGroup:!0,canEdit:!t.locked,canRemove:!(t.locked||t.disable_remove),canOpen:n.groupCache[t.id]!==undefined,access:t.ace_status,accessName:i(t.ace_status)}:(n.userCache[t.id]||(n.userCache[t.id]=window.UserManager.getUser(t.id)),r[t.id]={id:t.id,name:t.title,avatar:n.userCache[t.id].avatarSmall,isOwner:t.owner,canEdit:!(t.locked||t.owner),canRemove:!(t.locked||t.owner||t.disable_remove),access:t.ace_status,accessName:i(t.owner?"owner":t.ace_status)},t.owner&&(n.targetData.ownerId=t.id,!ASC.Files.Folders||ASC.Files.Folders.folderContainer!="corporate"||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()||n.targetData.isThirdparty||(r[t.id].canChange=!0))))}),r}function hu(){var t=[{id:ASC.Files.Constants.AceStatusEnum.ReadWrite,name:i(ASC.Files.Constants.AceStatusEnum.ReadWrite),hideForVisitor:!n.targetData.entryData||n.targetData.entryData.entryType=="file"}];return n.targetData.encrypted||(n.viewSettings.canWebCustomFilterEditing&&t.push({id:ASC.Files.Constants.AceStatusEnum.CustomFilter,name:i(ASC.Files.Constants.AceStatusEnum.CustomFilter),hideForVisitor:!0}),n.viewSettings.canWebReview&&t.push({id:ASC.Files.Constants.AceStatusEnum.Review,name:i(ASC.Files.Constants.AceStatusEnum.Review),hideForVisitor:!0}),n.viewSettings.canWebRestrictedEditing&&t.push({id:ASC.Files.Constants.AceStatusEnum.FillForms,name:i(ASC.Files.Constants.AceStatusEnum.FillForms),hideForVisitor:!0}),n.viewSettings.canWebComment&&t.push({id:ASC.Files.Constants.AceStatusEnum.Comment,name:i(ASC.Files.Constants.AceStatusEnum.Comment),hideForVisitor:!0}),t.push({id:ASC.Files.Constants.AceStatusEnum.Read,name:i(ASC.Files.Constants.AceStatusEnum.Read),hideForVisitor:!1})),t.push({id:ASC.Files.Constants.AceStatusEnum.Restrict,name:i(ASC.Files.Constants.AceStatusEnum.Restrict),hideForVisitor:!1}),t.push({id:ASC.Files.Constants.AceStatusEnum.Varies,name:i(ASC.Files.Constants.AceStatusEnum.Varies),hideForVisitor:!1,disabled:!0}),t}function cu(t,i){var e=jq("#defaultAccessRightsSetting"),u,f,o,r;e.length?(u=+e.find("input[type=radio]:checked").val(),f=[],e.find("input[type=checkbox]:checked").each(function(){f.push(+this.value)})):i&&(u=i.pop(),f=i);o=[];for(r of t)if(!r.disabled){if(f.indexOf(r.id)!=-1)return r.id;o.push(r.id)}return o.indexOf(u)!=-1?u:n.targetData.encrypted?ASC.Files.Constants.AceStatusEnum.ReadWrite:ASC.Files.Constants.AceStatusEnum.Read}function lu(t,i,r){if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var f=su(t),u=hu(),e=cu(u,i.defaultAccessRights);n.changeData(f,u,e);n.show()}function i(n){if(n=="owner")return ASC.Files.FilesJSResource.AceStatusEnum_Owner;n=parseInt(n);switch(n){case ASC.Files.Constants.AceStatusEnum.Read:return ASC.Files.FilesJSResource.AceStatusEnum_Read;case ASC.Files.Constants.AceStatusEnum.ReadWrite:return ASC.Files.FilesJSResource.AceStatusEnum_ReadWrite;case ASC.Files.Constants.AceStatusEnum.CustomFilter:return ASC.Files.FilesJSResource.AceStatusEnum_CustomFilter;case ASC.Files.Constants.AceStatusEnum.Restrict:return ASC.Files.FilesJSResource.AceStatusEnum_Restrict;case ASC.Files.Constants.AceStatusEnum.Varies:return ASC.Files.FilesJSResource.AceStatusEnum_Varies;case ASC.Files.Constants.AceStatusEnum.Review:return ASC.Files.FilesJSResource.AceStatusEnum_Review;case ASC.Files.Constants.AceStatusEnum.FillForms:return ASC.Files.FilesJSResource.AceStatusEnum_FillForms;case ASC.Files.Constants.AceStatusEnum.Comment:return ASC.Files.FilesJSResource.AceStatusEnum_Comment;default:return""}}function au(){n.targetData.needUpdate?vu():vt(null)}function vu(){ASC.Files.ServiceManager.getSharedInfoShort(ASC.Files.ServiceManager.events.GetSharedInfoShort,{showLoading:!0,objectID:n.targetData.id})}function vt(t,i,r){var u,f;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}u=t?{needUpdate:!0,sharingSettings:t}:{needUpdate:!1};u.Referer="onlyoffice";f=JSON.stringify(u);window.parent.postMessage(f,n.viewSettings.originForPost)}function yu(t,i){var f=[],h=null,e=!0,c,r,o,u,s,l;for(c in n.selected){r=n.selected[c];o=!0;for(u of n.targetData.sharingInfo)if(u.id===r.id){o=u.ace_status!=r.access?!0:u.linkSettings?u.title!=r.name||JSON.stringify(u.linkSettings)!=JSON.stringify(r.linkSettings):!1;break}o&&f.push(yt(r,r.access));r.isOwner&&r.id!=n.targetData.ownerId&&(h=r.id);e&&(e=r.isOwner||r.isLink&&r.access==ASC.Files.Constants.AceStatusEnum.Restrict)}for(u of n.targetData.sharingInfo)n.selected[u.id]||f.push(yt(u,ASC.Files.Constants.AceStatusEnum.None));f.length&&(n.targetData.needUpdate=!0);e&&(n.viewSettings.denyDownload=!1,n.viewSettings.denySharing=!1);s=n.viewSettings.displaySettings?{denyDownload:!!n.viewSettings.denyDownload,denySharing:!!n.viewSettings.denySharing}:undefined;l={entries:{entry:n.targetData.id},aces:{entry:f},message:i,advancedSettings:s};ASC.Files.ServiceManager.setAceObject(ASC.Files.ServiceManager.events.SetAceObject,{owner:h,showLoading:!0,notify:t,advancedSettings:s},{ace_collection:l})}function yt(n,t){function i(n){for(var t in n)n[t]||delete n[t];return n}return n.isLink&&n.linkSettings?{id:n.id,title:n.name,ace_status:t,linkSettings:i(n.linkSettings)}:{id:n.id,is_group:n.isGroup,ace_status:t}}function pu(t,i,r){var e,u,f,o;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}e=n.targetData.multiple?n.targetData.id:[n.targetData.id];for(o of e)u=ASC.Files.UI.parseItemId(o),f=ASC.Files.UI.getEntryObject(u.entryType,u.entryId),f.toggleClass("__active",t.indexOf(o)>-1),i.advancedSettings&&(ASC.Files.UI.setObjectData(f,"data-deny_download",i.advancedSettings.denyDownload),ASC.Files.UI.setObjectData(f,"data-deny_sharing",i.advancedSettings.denySharing));i.owner&&ASC.Files.Folders.changeOwner(e,i.owner);n.targetData.encrypted&&ASC.Desktop&&ASC.Desktop.setAccess&&(LoadingBanner&&LoadingBanner.displayLoading(),ASC.Files.UI.blockObject(n.targetData.id,!0,ASC.Files.FilesJSResource.DescriptCreate),ASC.Desktop.setAccess(u.entryId,function(t){t&&(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.DesktopMessageStoring),ASC.Files.Folders?ASC.Files.Folders.replaceFileStream(u.entryId,"",t,!0,null,!0):Teamlab.updateFileStream({fileId:u.entryId,encrypted:!0,forcesave:!0},t));LoadingBanner&&LoadingBanner.hideLoading();n.hide()}))}function wu(t,i){n.tooltipTimeout=setTimeout(function(){var u=i&&n.openedGroupElement?n.openedGroupElement.nextElementSibling.children[t]:n.contentListElement.children[t];if(u){var r=n.userCache[t],e=n.groupCache[i||r.groups[0]],o={avatar:r.avatarBig,userName:new URL(window.location.protocol+"//"+window.location.hostname+r.profileUrl).searchParams.get("user"),displayName:r.displayName,groups:e?[e]:null,title:r.title},s=jq.tmpl("userProfileCardTmpl",o);n.$itemTooltipDialog.html(s);f(u,n.itemTooltipDialogHelper,n.$itemTooltipDialog,8)}},1e3)}function pt(t){n.$itemTooltipDialog.is(t.relatedTarget)||n.$itemTooltipDialog.has(t.relatedTarget).length||(clearTimeout(n.tooltipTimeout),n.itemTooltipDialogHelper.hide())}function bu(){n.$linkSettingsInput.data("available",jq("#cbxExternalShare").prop("checked")).data("social",jq("#cbxExternalShareSocialMedia").prop("checked"))}function ku(){var i,t;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetShortenLink,vr);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfoShort,vt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfo,lu);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceObject,pu);n.$topContentContainer.append(n.userSelector.dialogElement);n.userSelectorDialogHelper=new DialogHelper(n.$addUserBtn.get(0),n.userSelector.dialogElement,bt,null,!1,!0);n.userSelector.onCancel=n.userSelectorDialogHelper.hide;n.$addLinkBtn.on("click",gt);n.addLinkActionDialogHelper=new DialogHelper(n.$addLinkBtnArrow.get(0),n.$addLinkActionDialog.get(0),rr);n.$addLinkActionDialog.on("click",".dropdown-item",ur);n.searchDialogHelper=new DialogHelper(null,n.$searchDialog.get(0),ti,ii,!0,!0,n.$searchInput.get(0));n.$searchInput.on("mousedown",function(){n.searchDialogHelper.addSelection()});n.$searchInput.on("mouseup blur",function(){n.searchDialogHelper.removeSelection()});n.$searchDialogContentListParent.on("click",".us-name, .us-show-more",function(n){this.classList.contains("us-show-more")?fi(this,n):ui(this,n)});n.$contentListParent.on("click",".us-name, .us-show-more",function(n){this.classList.contains("disabled")||(this.classList.contains("us-show-more")?yi(this,n):this.classList.contains("changeable")&&n.target==this.querySelector(".us-name-text span")?pi(this,n):n.target.classList.contains("us-access")?wi(this,n):n.target.classList.contains("us-avatar")?gi(this,n):this.classList.contains("us-groupname")?nr(this,n):this.classList.contains("us-linkname")?tt(this,n):this.classList.contains("us-folder-linkname")?tt(this,n):tr(this,n))});n.itemTooltipDialogHelper=new DialogHelper(null,n.$itemTooltipDialog.get(0));n.$contentListParent.on("mouseover mouseout",".us-name:not(.us-linkname):not(.us-folder-linkname):not(.us-groupname):not(.disabled) .us-name-text span",function(n){var t=this.closest(".us-name");n.type=="mouseover"&&wu(t.id,t.getAttribute("data-group"));n.type=="mouseout"&&pt(n)});n.$itemTooltipDialog.on("mouseout",pt);n.menuSelectDialogHelper=new DialogHelper(n.$menuActionSelectAll.get(0),n.$menuSelectDialog.get(0));n.$menuSelectDialog.on("click",".dropdown-item",function(n){oi(this,n)});n.$menuActionSelectAllCbx.on("click",function(t){t.stopPropagation();n.menuSelectDialogHelper.hide();ei(this,t)});n.menuAccessRightsDialogHelper=new DialogHelper(n.$menuActionChangeBtn.get(0),n.$menuAccessRightsDialog.get(0),si);n.$menuAccessRightsDialog.on("click",".access-rights-item",function(n){di(this,n);u()});n.$menuActionRemoveBtn.on("click",function(n){this.classList.contains("unlockAction")&&(hi(this,n),u())});n.$menuActionCloseBtn.on("click",function(n){l(this,n)});n.linkActionDialogHelper=new DialogHelper(null,n.$linkActionDialog.get(0),or);n.$linkActionDialog.on("click",".dropdown-item",function(n){vi(this,n)});n.linkShareDialogHelper=new DialogHelper(null,n.$linkShareDialog.get(0),sr);n.$linkShareDialogInput.on("mousedown",ht);n.$linkShareDialogInput.on("keypress",ct);n.$linkShareDialogSocialContainer.on("click","a",function(n){return lr(this,n)});n.$linkShareDialogShort.on("click",st);n.linkEmbedDialogHelper=new DialogHelper(null,n.$linkEmbedDialog.get(0),cr);n.$linkEmbedDialogSizeItem.on("click",w);n.$linkEmbedDialogSizeCustom.on("change",w);n.$linkEmbedDialogInput.on("mousedown",ht);n.$linkEmbedDialogInput.on("keypress",ct);n.linkPasswordDialogHelper=new DialogHelper(null,n.$linkPasswordDialog.get(0),dr);n.$linkPasswordDialogCbx.on("change",function(){at(!this.checked,n.$linkPasswordDialog);this.checked&&setTimeout(function(){n.$linkPasswordDialogInput.get(0).focus()},0)});n.$linkPasswordDialogShow.on("click",gr);n.$linkPasswordDialogRandom.on("click",nu);n.$linkPasswordDialogClean.on("click",function(){lt(this,n.$linkPasswordDialog)});n.$linkPasswordDialogSaveBtn.on("click",function(){n.linkPasswordDialogHelper.hide();tu()});n.$linkPasswordDialogCancelBtn.on("click",function(){n.linkPasswordDialogHelper.hide()});n.$linkLifetimeDialogCbx.on("change",function(){at(!this.checked,n.$linkLifetimeDialog)});n.$linkLifetimeDialogDateInput.datepicker({selectDefaultDate:!1,minDate:new Date});n.$linkLifetimeDialogDateInput.mask(ASC.Resources.Master.DatePatternJQ);i=jq("#ui-datepicker-div").addClass("blockMsg");n.linkLifetimeDialogHelper=new DialogHelper(null,n.$linkLifetimeDialog.get(0),iu,null,!1,!0,i.get(0));t=function(n){return n=n.split(":"),parseInt(n[0])>19?"Hh:M0":"H0:M0"};spOptions={onKeyPress:function(n,i,r,u){r.mask(t.apply({},arguments),u)},translation:{H:{pattern:/[0-2]/,optional:!1},h:{pattern:/[0-3]/,optional:!1},M:{pattern:/[0-5]/,optional:!1}}};n.$linkLifetimeDialogTimeInput.mask(t,spOptions);n.$linkLifetimeDialogClean.on("click",function(){lt(this,n.$linkLifetimeDialog)});n.$linkLifetimeDialogSaveBtn.on("click",function(){ru()});n.$linkLifetimeDialogCancelBtn.on("click",function(){n.linkLifetimeDialogHelper.hide()});n.linkDeleteDialogHelper=new DialogHelper(null,n.$linkDeleteDialog.get(0));n.$linkDeleteDialogOkBtn.on("click",function(){n.linkDeleteDialogHelper.hide();y(n.currentElement.id)});n.$linkDeleteDialogCancelBtn.on("click",function(){n.linkDeleteDialogHelper.hide()});n.itemAccessRightsDialogHelper=new DialogHelper(null,n.$itemAccessRightsDialog.get(0));n.$itemAccessRightsDialog.on("click",".access-rights-item",function(n){bi(this,n)});n.$saveBtnMain.on("click",function(){n.save(!0,"")});n.saveActionDialogHelper=new DialogHelper(n.$saveBtnArrow.get(0),n.$saveActionDialog.get(0));n.$saveActionDialog.on("click",".dropdown-item",fr);n.$cancelBtn.on("click",function(){n.hide()});n.messageDialogHelper=new DialogHelper(null,n.$messageDialog.get(0));n.$messageDialogSaveBtn.on("click",function(){n.messageDialogHelper.hide();n.save(!0,n.$messageDialogTextarea.val().trim())});n.$messageDialogCancelBtn.on("click",function(){n.messageDialogHelper.hide()});n.advancedSettingsDialogHelper=new DialogHelper(n.$settingsBtnContainer.get(0),n.$advancedSettingsDialog.get(0),er);n.$advancedSettingsDialogSaveBtn.on("click",function(){n.viewSettings.denyDownload=n.$advancedSettingsDialogDenyDownloadCbx.prop("checked");n.viewSettings.denySharing=n.$advancedSettingsDialogDenySharingCbx.prop("checked");n.advancedSettingsDialogHelper.hide();u()});n.$advancedSettingsDialogCancelBtn.on("click",function(){n.advancedSettingsDialogHelper.hide()});uu()}var a=ASC.Resources.Master.ResourceJS,e=ASC.Files.FilesJSResource,n={},t={none:0,root:1,group:2},v;return n.userCache=window.UserManager.getAllUsers(!0),n.groupCache=window.GroupManager.getAllGroups(),n.accessRights=[],n.defaultAccessRight=null,n.defaultAccessRightForVisitor=null,n.selected={},n.tmpSelected={},n.pagging={renderBy:100,searchItemsNumber:0,contentItemsNumber:0,usersItemsNumber:0},n.searchResult=null,n.selectionMode=t.none,n.currentElement=null,n.openedGroupElement=null,n.tooltipTimeout=null,n.clipboard={internalLink:null,externalLinkAction:null,externalLinkShare:null,externalLinkEmbed:null,externalLinkPassword:null},n.targetData={id:null,sharingInfo:null,needUpdate:!1,ownerId:null,multiple:!1,encrypted:!1,entryData:null,entryLink:null,isThirdparty:!1},n.viewSettings={title:"",notifyAvailable:!1,externalLinksAvailable:!1,asFlat:!1,showTooltop:!1,rootFolderTypeCommon:!1,originForPost:"*",displaySettings:!1,denyDownload:!1,denySharing:!1,canWebCustomFilterEditing:!1,canWebReview:!1,canWebRestrictedEditing:!1,canWebComment:!1,canLinkReadWrite:!1,hasMailAccounts:undefined},n.$dialog=jq("#sharingDialog"),n.$dialogHeader=n.$dialog.find(".containerHeaderBlock td:first-of-type"),n.$topContentContainer=n.$dialog.find(".dialog-top-content-container"),n.$topButtonContainer=n.$dialog.find(".top-button-container"),n.$addUserBtn=n.$topButtonContainer.find(".user-button"),n.$addLinkBtn=n.$topButtonContainer.find(".link-button"),n.$addLinkBtnArrow=n.$topButtonContainer.find(".arrow-part"),n.$linkSettingsInput=n.$topButtonContainer.find(".link-settings"),n.$bottomButtonContainer=n.$dialog.find(".bottom-button-container"),n.$saveBtnMain=n.$bottomButtonContainer.find(".button.blue.main-part"),n.$saveBtnArrow=n.$bottomButtonContainer.find(".button.blue.arrow-part"),n.$cancelBtn=n.$bottomButtonContainer.find(".button.gray:not(.settings-link)"),n.$settingsBtnContainer=n.$bottomButtonContainer.find(".settings-link-container"),n.$settingsBtns=n.$settingsBtnContainer.find(".settings-link"),n.$actionsContainer=n.$dialog.find(".group-actions"),n.$menuActionSelectAll=n.$actionsContainer.find(".menuActionSelectAll"),n.$menuActionSelectAllCbx=n.$menuActionSelectAll.find("input[type=checkbox]"),n.$menuActionChangeBtn=n.$actionsContainer.find(".menuActionChange"),n.$menuActionRemoveBtn=n.$actionsContainer.find(".menuActionRemove"),n.$menuActionCloseBtn=n.$actionsContainer.find(".menuActionClose"),n.$menuSelectDialog=n.$actionsContainer.find(".menu-select-dialog"),n.$menuAccessRightsDialog=n.$actionsContainer.find(".menu-access-rights-dialog"),n.$searchContainer=n.$dialog.find(".us-hot-search"),n.$searchInput=n.$searchContainer.find(".textEdit"),n.$searchDialog=n.$searchContainer.find(".us-popup-dialog"),n.$searchDialogContentListParent=n.$searchDialog.find(".us-list-parent"),n.$contentListParent=n.$dialog.find(".content-list"),n.$itemAccessRightsDialog=n.$contentListParent.find(".item-access-rights-dialog"),n.$linkActionDialog=n.$contentListParent.find(".link-action-dialog"),n.$linkShareDialog=n.$contentListParent.find(".link-share-dialog"),n.$linkEmbedDialog=n.$contentListParent.find(".link-embed-dialog"),n.$linkPasswordDialog=n.$contentListParent.find(".link-password-dialog"),n.$linkLifetimeDialog=n.$contentListParent.find(".link-lifetime-dialog"),n.$linkDeleteDialog=n.$contentListParent.find(".link-delete-dialog"),n.$itemTooltipDialog=n.$contentListParent.find(".item-tooltip-dialog"),n.$addLinkActionDialog=n.$topContentContainer.find(".addlink-action-dialog"),n.$addLinkActionDialogNew=n.$addLinkActionDialog.find(".addlink-new-action"),n.$addLinkActionDialogCopy=n.$addLinkActionDialog.find(".addlink-copy-action"),n.$linkShareDialogSocialContainer=n.$linkShareDialog.find(".link-share-social"),n.$linkShareDialogInput=n.$linkShareDialog.find(".link-share-around input"),n.$linkEmbedDialogSizeItem=n.$linkEmbedDialog.find(".embed-size-item"),n.$linkEmbedDialogSizeCustom=n.$linkEmbedDialog.find(".embed-size-custom"),n.$linkEmbedDialogSizeCustomWidth=n.$linkEmbedDialog.find(".embed-size-width"),n.$linkEmbedDialogSizeCustomHeight=n.$linkEmbedDialog.find(".embed-size-height"),n.$linkEmbedDialogInput=n.$linkEmbedDialog.find(".link-embed-around input.border-none"),n.$linkPasswordDialogCbx=n.$linkPasswordDialog.find(".on-off-checkbox"),n.$linkPasswordDialogInput=n.$linkPasswordDialog.find(".textEdit"),n.$linkPasswordDialogShow=n.$linkPasswordDialog.find(".img-btn.show"),n.$linkPasswordDialogRandom=n.$linkPasswordDialog.find(".img-btn.random"),n.$linkPasswordDialogClean=n.$linkPasswordDialog.find(".link.dotline.clean"),n.$linkPasswordDialogCopy=n.$linkPasswordDialog.find(".link.dotline.copy"),n.$linkPasswordDialogSaveBtn=n.$linkPasswordDialog.find(".button.blue"),n.$linkPasswordDialogCancelBtn=n.$linkPasswordDialog.find(".button.gray"),n.$linkLifetimeDialogCbx=n.$linkLifetimeDialog.find(".on-off-checkbox"),n.$linkLifetimeDialogDateInput=n.$linkLifetimeDialog.find(".textEditCalendar.date"),n.$linkLifetimeDialogTimeInput=n.$linkLifetimeDialog.find(".textEdit.time"),n.$linkLifetimeDialogClean=n.$linkLifetimeDialog.find(".link.dotline"),n.$linkLifetimeDialogAutodeleteCbx=n.$linkLifetimeDialog.find(".autodelete"),n.$linkLifetimeDialogSaveBtn=n.$linkLifetimeDialog.find(".button.blue"),n.$linkLifetimeDialogCancelBtn=n.$linkLifetimeDialog.find(".button.gray"),n.$linkDeleteDialogOkBtn=n.$linkDeleteDialog.find(".button.blue"),n.$linkDeleteDialogCancelBtn=n.$linkDeleteDialog.find(".button.gray"),n.$linkActionDialogCopy=n.$linkActionDialog.find(".link-action-copy"),n.$linkShareDialogCopy=n.$linkShareDialog.find(".link-share-action-copy"),n.$linkEmbedDialogCopy=n.$linkEmbedDialog.find(".link-embed-action-copy"),n.$linkActionDialogEmbed=n.$linkActionDialog.find(".link-action-embed"),n.$linkActionDialogPassword=n.$linkActionDialog.find(".link-action-password"),n.$linkActionDialogLifetime=n.$linkActionDialog.find(".link-action-lifetime"),n.$linkActionDialogRename=n.$linkActionDialog.find(".link-action-rename"),n.$linkActionDialogDelete=n.$linkActionDialog.find(".link-action-delete"),n.$linkActionDialogShort=n.$linkActionDialog.find(".link-action-short"),n.$linkShareDialogShort=n.$linkShareDialog.find(".link-share-action-short"),n.$emptyList=n.$dialog.find(".empty-list"),n.$saveActionDialog=n.$dialog.find(".save-action-dialog"),n.$saveActionDialogMessage=n.$saveActionDialog.find(".save-action-message"),n.$saveActionDialogMessageParent=n.$saveActionDialogMessage.parent(),n.$saveActionDialogSilent=n.$saveActionDialog.find(".save-action-silent"),n.$saveActionDialogSilentParent=n.$saveActionDialogSilent.parent(),n.$saveActionDialogCopy=n.$saveActionDialog.find(".save-action-copy"),n.$saveActionDialogCopyParent=n.$saveActionDialogCopy.parent(),n.$saveActionDialogSeporator=n.$saveActionDialogCopyParent.prev(),n.$messageDialog=n.$dialog.find(".message-dialog"),n.$messageDialogTextarea=n.$messageDialog.find("textarea"),n.$messageDialogSaveBtn=n.$messageDialog.find(".button.blue"),n.$messageDialogCancelBtn=n.$messageDialog.find(".button.gray"),n.$advancedSettingsDialog=n.$dialog.find(".advanced-settings-dialog"),n.$advancedSettingsDialogDenyDownloadCbx=n.$advancedSettingsDialog.find(".deny-download"),n.$advancedSettingsDialogDenyDownloadLabel=n.$advancedSettingsDialogDenyDownloadCbx.parent(),n.$advancedSettingsDialogDenySharingCbx=n.$advancedSettingsDialog.find(".deny-sharing"),n.$advancedSettingsDialogDenySharingLabel=n.$advancedSettingsDialogDenySharingCbx.parent(),n.$advancedSettingsDialogSaveBtn=n.$advancedSettingsDialog.find(".button.blue"),n.$advancedSettingsDialogCancelBtn=n.$advancedSettingsDialog.find(".button.gray"),n.searchDialogListParentElement=n.$searchDialogContentListParent.get(0),n.contentListParentElement=n.$contentListParent.get(0),n.contentListElement=n.contentListParentElement.querySelector(".us-list"),n.userDomGenerator=new UserDomGenerator,n.ownerSelector=null,n.userSelector=new UserSelector({userCache:n.userCache,groupCache:n.groupCache,accessRights:n.accessRights,defaultAccessRight:n.defaultAccessRight,selected:n.selected,userDomGenerator:n.userDomGenerator,singleChoice:!1,groupSelection:!0,onSave:function(t,f){var h=n.accessRights.find(function(n){return n.id==f&&!n.hideForVisitor}),c=h?h.id:n.defaultAccessRightForVisitor,e,o,s;for(e in n.selected)t[e]===undefined&&delete n.selected[e];for(e in t)n.selected[e]===undefined&&(o=t[e],s=f,!o.isGroup&&n.userCache[e].isVisitor&&(s=c),o.access=s,o.accessName=i(s),o.canEdit=!0,o.canRemove=!0,n.selected[e]=o);r();u()}}),n.userSearcher=new UserSearcher(n.groupCache,n.userCache,n.$searchContainer.get(0),ri),n.show=function(){var t=n.viewSettings.externalLinksAvailable&&!n.targetData.multiple,i;t&&n.targetData.entryData&&n.targetData.entryData.entryType==="file"&&n.$addLinkBtn.data("trial")&&(t=ASC.Files.Utility.CanWebView(n.targetData.entryData.title));t?(n.$addLinkBtn.removeClass("display-none"),n.targetData.entryLink?(n.$addLinkBtn.addClass("main-part"),n.$addLinkBtnArrow.removeClass("display-none")):(n.$addLinkBtn.removeClass("main-part"),n.$addLinkBtnArrow.addClass("display-none"))):(n.$addLinkBtn.addClass("display-none"),n.$addLinkBtnArrow.addClass("display-none"));n.targetData.entryLink?n.$saveActionDialogCopyParent.show():n.$saveActionDialogCopyParent.hide();n.viewSettings.displaySettings=n.viewSettings.displaySettings&&n.targetData.ownerId==Teamlab.profile.id;n.viewSettings.displaySettings?n.$settingsBtnContainer.show():n.$settingsBtnContainer.hide();n.viewSettings.notifyAvailable?(n.$saveActionDialogMessageParent.show(),n.$saveActionDialogSilentParent.show()):(n.$saveActionDialogMessageParent.hide(),n.$saveActionDialogSilentParent.hide());n.targetData.entryLink&&n.viewSettings.notifyAvailable?n.$saveActionDialogSeporator.show():n.$saveActionDialogSeporator.hide();dt();n.targetData.entryLink||n.viewSettings.notifyAvailable?(n.$saveBtnMain.addClass("main-part").removeClass("single-btn"),n.$saveBtnArrow.removeAttr("style")):(n.$saveBtnMain.removeClass("main-part").addClass("single-btn"),n.$saveBtnArrow.hide());i=n.viewSettings.rootFolderTypeCommon||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"?ASC.Files.FilesJSResource.AccessSettingsHeader.format(n.viewSettings.title):ASC.Files.FilesJSResource.SharingSettingsHeader.format(n.viewSettings.title);n.viewSettings.showTooltop||n.$contentListParent.off("mouseover mouseout");n.viewSettings.asFlat?(n.$dialog.addClass("flat").show(),PopupKeyUpActionProvider.EnterAction=PopupKeyUpActionProvider.CtrlEnterAction="jq('.bottom-button-container .button:visible:first').trigger('click');",PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Share.updateForParent();",PopupKeyUpActionProvider.ForceBinding=!0):(n.$dialogHeader.attr("title",i).text(i),StudioBlockUIManager.blockUI(n.$dialog));ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();n.$dialog.trigger("click")},n.hide=function(){PopupKeyUpActionProvider.CloseDialog()},n.save=function(t,i){t=t&&n.viewSettings.notifyAvailable;i=t?i:"";yu(t,i);n.targetData.encrypted||n.hide()},n.changeData=function(t,i,r){n.selected=t;n.accessRights=i;n.defaultAccessRight=r;var u=i.find(function(n){return n.id==r&&!n.hideForVisitor});n.defaultAccessRightForVisitor=u?u.id:ASC.Files.Constants.AceStatusEnum.Read;n.userSelector.changeData(n.selected,n.accessRights,n.defaultAccessRight);n.pagging.contentItemsNumber=0;n.currentElement=null;n.openedGroupElement=null;ut();l()},v=!1,{init:wt,updateForParent:au,getSharedInfo:ou,changeExternalShareSettings:bu,unSubscribeMe:function(n,t){ASC.Files.Unsubscribe.unSubscribeMe(n,t)}}}();jq(document).ready(function(){(function(){ASC.Files.Share.init();jq("#studioPageContent").on("click","#buttonShare, #mainShare.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();var n=[],t=[];jq("#filesMainContent .file-row:not(.without-share):not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.files-encrypted):has(.checkbox input:checked)").each(function(){var i=ASC.Files.UI.getObjectData(this),r=i.entryType,u=i.entryId;n.push(r+"_"+u);t.push(i.title)});ASC.Files.Share.getSharedInfo(n,t)});jq("#filesMainContent").on("click",".btn-row",function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.entryType,r=n.title;return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(n.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),ASC.Files.Share.getSharedInfo(i+"_"+t,r),!1})})(jQuery)});
