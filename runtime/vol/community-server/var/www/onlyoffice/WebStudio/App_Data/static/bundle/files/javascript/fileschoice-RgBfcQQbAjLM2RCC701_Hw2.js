typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,ctrl:17,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,F2:113},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,"async":!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(f){throw"Can't translate xml : "+f;}try{i=jq("<div>").append(u).html()}catch(f){throw"Can't serialized xml : "+f;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();
window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},r=!0,u=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},i=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var u,f,r=0;r<i.length;r++)if(u=i[r],u.eventType==n&&u.params==JSON.stringify(t)){if(f=new Date-u.timeStamp,0<f&&f<p)return c.apply(this,u.data),!0;i.splice(r,1);r--}return!1},k=function(n){for(var r,t=0;t<i.length;t++)r=i[t],r.eventType==n&&(i.splice(t,1),t--)},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},d=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},g=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=d(t[n]),t[n][f]={handler:i,type:u},f)},nt=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},tt=function(){var i,n,r,t;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),i=e,arguments.length===0)return i;for(n=0,r=arguments.length-1;n<r;n++)i+=arguments[n]+a;return t=i+arguments[n],ASC.Files.Utility&&(t=ASC.Files.Utility.AddExternalShareKey(t)),t+((t.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,i,f,e){var y,c,w,k;if(r=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(!f.responseXML&&f.responseText.indexOf("<error")==0)try{f.responseXML=ASC.Files.TemplateManager.createXML(f.responseText)}catch(d){}if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(i){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=JSON.parse(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||JSON.parse(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);u.length!=0&&r==!0&&(k=u.shift(),r=!1,l(k))},it=function(n,t,r){return function(){for(var u=[n,t,r],f=0,e=arguments.length;f<e;f++)u.push(arguments[f]);jq.inArray(n,w())>=0&&i.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:u});c.apply(this,u)}},n=function(n,t,i,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof i=="string"&&(typeof f=="undefined"&&(f={}),!b(i,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":case"put":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={"async":f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:tt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:it(i,f,t)};u.length==0&&r==!0?(r=!1,l(c)):u.push(c)}},l=function(n){jq.ajax({"async":n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},rt=function(t,i){i.ajaxsync=!0;n("post","xml",t,i,null,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},ut=function(t,i){i.ajaxsync=!0;n("post","xml",t,i,null,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID||"")+"&title="+encodeURIComponent(i.fileTitle)+"&templateId="+encodeURIComponent(i.templateId||""))},ft=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},et=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},st=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},ht=function(t,i,r){n("post","json",t,i,r,"folders-entries?filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},ct=function(t,i){i.ajaxsync=!0;n("get",i.dataType||"xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},lt=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},at=function(t,i){n("put","json",t,i,null,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},vt=function(t,i){n("put","json",t,i,null,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},yt=function(t,i){n("put","json",t,i,null,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},pt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&parentId="+encodeURIComponent(i.folderId||"")+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},wt=function(t,i){n("get","json",t,i,"presigned?fileId="+encodeURIComponent(i.fileId))},bt=function(t,i){n("put","xml",t,i,null,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},kt=function(t,i){n("put","xml",t,i,null,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},dt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},gt=function(t,i,r){n("put","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},ni=function(t,i,r){n("put","json",t,i,r,"folders-files?action=delete")},ti=function(t,i){n("put","json",t,i,null,"emptytrash")},ii=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("put","json",t,i,r,"bulkdownload")},ri=function(t,i){n("get","json",t,i,"tasks-statuses")},ui=function(t,i){n("put","json",t,i,null,"tasks")},fi=function(t,i){n("get","json",t,i,"autocleanup")},ei=function(t,i,r){n("post","json",t,i,r,"checkediting")},oi=function(t,i){n("put","json",t,i,null,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},si=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},hi=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},ci=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},li=function(t,i,r){n("post","json",t,i,r,"removeace")},ai=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId)+(i.linkId?"&linkId="+encodeURIComponent(i.linkId):"")+"&isFolder="+(i.isFolder===!0))},vi=function(t,i){n("get","json",t,i,"getexternallink?entryId="+encodeURIComponent(i.entryId))},yi=function(t,i){n("get","json",t,i,"publickeys?fileId="+encodeURIComponent(i.fileId))},pi=function(t,i){n("get","json",t,i,"sharedusers?fileId="+encodeURIComponent(i.fileId))},wi=function(t,i){n("get","json",t,i,"protectusers?fileId="+encodeURIComponent(i.fileId))},bi=function(t,i,r){n("post","json",t,i,r,"sendeditornotify?fileId="+encodeURIComponent(i.fileId))},ki=function(t,i){n("put","json",t,i,null,"external?enable="+(i.enable===!0))},di=function(t,i){n("put","json",t,i,null,"externalsocialmedia?enable="+(i.enable===!0))},gi=function(t,i,r){n("post","json",t,i,r,"checkconversion")},nr=function(t,i){n("put","json",t,i,null,"updateifexist?set="+i.value)},tr=function(t,i){n("put","json",t,i,null,"forcesave?set="+i.value)},ir=function(t,i){n("put","json",t,i,null,"storeforcesave?set="+i.value)},rr=function(t,i){n("put","json",t,i,null,"changedeleteconfrim?set="+i.value)},ur=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},fr=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},er=function(t,i){n("delete","json",t,i,"thirdparty-delete?providerId="+i.providerId)},or=function(t,i){n("put","json",t,i,null,"thirdparty?enable="+(i.enable===!0))},sr=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},hr=function(t,i){n("delete","json",t,i,"docusign-delete")},cr=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},lr=function(t,i,r){n("put","json",t,i,r,"markasread")},ar=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},vr=function(t,i){n("get","xml",t,i,"gettemplates?filter="+i.filter+"&from="+i.from+"&count="+i.count+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search)+(i.extension?"&extension="+encodeURIComponent(i.extension):""))},yr=function(t,i){n("put","xml",t,i,null,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},pr=function(t,i){n("put","json",t,i,null,"file-favorite?fileId="+encodeURIComponent(i.fileId)+"&favorite="+(i.favorite===!0))},wr=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},br=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},kr=function(t,i){n("put","json",t,i,null,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},kr=function(t,i){n("put","json",t,i,null,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},dr=function(t,i){n("get","json",t,i,"reference-data?fileKey="+encodeURIComponent(i.fileKey)+"&instanceId="+encodeURIComponent(i.instanceId)+"&sourceFileId="+encodeURIComponent(i.sourceFileId)+"&path="+encodeURIComponent(i.path))},gr=function(t,i){n("get","json",t,i,"mailaccounts")},nu=function(t,i){n("get","json",t,i,"gethelpcenter")},tu=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:g,unbind:nt,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetAutoCleanup:"GetAutoCleanup",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",GetMediaFile:"getmediafile",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",GetFileSharedInfo:"getfilesharedinfo",SetAceFileLink:"setacefilelink",GetEncryptionAccess:"getencryptionaccess",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",GetExternalLink:"getexternallink",GetPresignedUri:"getpresigneduri",ChangeExternalShareSettings:"changeexternalsharesettings",ChangeExternalShareSocialMediaSettings:"changeexternalsharesocialmediasettings",GetUsers:"getusers",SendEditorNotify:"sendeditornotify",MarkAsRead:"markasread",GetNews:"getnews",ToggleFavorite:"togglefavorite",GetTemplates:"gettemplates",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",Forcesave:"forcesave",StoreForcesave:"storeforcesave",GetHelpCenter:"gethelpcenter",ChangeDeleteConfrim:"changedeleteconfrim",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetReferenceData:"getreferencedata",GetReferenceLink:"getreferencelink",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:rt,createNewFile:ut,getFolderItems:ft,getTreeSubFolders:et,getTreePath:ot,getFolder:st,getItems:ht,getFile:ct,getFileHistory:lt,setCurrentVersion:at,updateComment:vt,completeVersion:yt,getSiblingsImage:pt,getPresignedUri:wt,renameFolder:bt,renameFile:kt,changeOwner:tu,moveFilesCheck:dt,moveItems:gt,deleteItem:ni,emptyTrash:ti,download:ii,getTasksStatuses:ri,terminateTasks:ui,checkEditing:ei,getAutoCleanup:fi,setAceLink:oi,getSharedInfo:si,getSharedInfoShort:hi,setAceObject:ci,unSubscribeMe:li,getShortenLink:ai,getExternalLink:vi,getEncryptionAccess:yi,changeExternalShareSettings:ki,changeExternalShareSocialMediaSettings:di,getSharedUsers:pi,getProtectUsers:wi,sendEditorNotify:bi,checkConversion:gi,updateIfExist:nr,forcesave:tr,storeForcesave:ir,changeDeleteConfrim:rr,getThirdParty:ur,saveThirdParty:fr,deleteThirdParty:er,changeAccessToThirdparty:or,saveDocuSign:sr,deleteDocuSign:hr,sendDocuSign:cr,markAsRead:lr,getNews:ar,getTemplates:vr,lockFile:yr,toggleFavorite:pr,removeFromCache:k,getEditHistory:wr,getDiffUrl:br,restoreVersion:kr,getReferenceData:dr,getMailAccounts:gr,getHelpCenter:nu}}();
window.ASC.Files.UI=function(){var t=!1,i=null,u=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),n=function(){var t=null,n=[];return{getFiles:function(){return n},setFolder:function(i){i!=t&&(t=i,n=[])},setFile:function(t){n.indexOf(t)<0&&n.push(t)}}}(),f=function(){t===!1&&(t=!0);jq(window).on("resize",function(){r();ASC.Files.UI.fixContentHeaderWidth();e()});jq(window).on("resizeWinTimerWithMaxDelay",function(){r();ASC.Files.UI.fixContentHeaderWidth()});if(!ASC.Resources.Master.IsAuthenticated){ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:!1};return}var n=function(n){var t=n.IsAutoCleanUp,i=n.Gap;ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:t,gap:i};t||jq("#selectGapToAutoCleanUp").val("1").trigger("change")};ASC.Files.ServiceManager&&(ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetAutoCleanup,n),ASC.Files.ServiceManager.getAutoCleanup(ASC.Files.ServiceManager.events.GetAutoCleanup))},e=function(){jq("#filesMainContent").hasClass("thumbnails")&&(jq("#contentVersions").remove(),clearTimeout(i),i=setTimeout(function(){var n=jq(".display-versions");n.length&&ASC.Files.Folders.showVersions(n)},500))},o=function(){},s=function(n){n=jq(n);n.hasClass("display-versions")&&ASC.Files.Folders.closeVersions();n.remove()},h=function(n,t){if(n&&t){if(!ASC.Files.Common.isCorrectId(t))return null;var i=ASC.Files.UI.getObjectData(".to-parent-folder-dropdown");return i!=null&&i.entryId==t&&i.entryType==n?jq(".to-parent-folder-dropdown"):jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t))}return null},c=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},l=function(n){var u,r,f,i,t;return(n=jq(n),u='input:hidden[name="entry_data"]',r=n.parent(),n.is(".to-parent-folder-link")||r.is(".to-parent-folder-dropdown")||r.is("#filesBreadCrumbs")?n=r:n.is(".file-row")||(f=".file-row",n.is(".jstree *")?(f=".tree-node",u='> a input:hidden[name="entry_data"]'):n.closest("#contentVersions").length&&(n=jq(".display-versions")),n=n.closest(f)),n.length==0)?null:(i=n.find(u),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.content_length_string=i.attr("data-content_length_string"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.deny_download=i.attr("data-deny_download")==="true",t.deny_sharing=i.attr("data-deny_sharing")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t.folderUrl=i.attr("data-folder_url"),t.folder_id=i.attr("data-folder_id"),t.folder_is_favorite=i.attr("data-folder_is_favorite"),t.encrypted=i.attr("data-encrypted")==="true",t.thumbnail_status=i.attr("data-thumbnail_status"),t.deleted_permanently_date=i.attr("data-deleted_permanently_date"),t.parent_folder_id=i.attr("data-parent_folder_id"),t)},a=function(n,t,i){if(n=jq(n),n.length!=0){var r=n.find('input:hidden[name="entry_data"]');r.length&&r.attr(t,i)}},v=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},y=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},p=function(n){return(n=jq(n),n.is(".file-row")||n.is(".to-parent-folder-dropdown")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},w=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)?r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(i,!0)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.MediaPlayer.getPlayHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},b=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},k=function(t){var u=ASC.Files.Constants.storageKeyCompactView,i,r;typeof t=="undefined"&&(i=localStorageManager.getItem(u)||!1,t=i,typeof i=="boolean"&&(t=i?"compact":"normal"));ASC.Files.Folders.closeVersions();jq("#switchViewFolder, #filesMainContent").removeClass("thumbnails normal compact");jq("#switchViewFolder, #filesMainContent").addClass(t);localStorageManager.setItem(u,t);t=="thumbnails"?(jq("#filesMainContent").find(".file-row .thumb-img img[src='']").each(function(){var n=jq(this),t=n.attr("data-src");n.on("error",ASC.Files.EventHandler.onThumbnailError).attr("src",t)}),jq("#filesMainContent").css("display","grid"),r=n.getFiles(),r.length&&Teamlab.createThumbnails(null,{fileIds:r})):jq("#filesMainContent").css("display","block");ASC.Files.Folders.showMore&&t!="compact"&&ASC.Files.UI.trackShowMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},d=function(){return jq("#settingCommon, #settingAdmin, #settingThirdPartyPanel, #helpPanel").is(":visible")},g=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},r=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},nt=function(){var n=jq("#mainContentHeader .down_arrow");n.length&&(ASC.Files.UI.stickMovingPanel("mainContentHeader",jq("#filesSelectorPanel:visible")),ASC.Files.UI.fixContentHeaderWidth())},tt=function(n,t){var i=jq("#"+n),u,r,o,f,s,e;i.is(":visible")&&(t&&t.hide(),u=n+"Spacer",r=jq("#"+u),o=jq("#"+u+":visible").length==0?i.offset().top:r.offset().top,f=jq(window),s=f.scrollTop(),s>=o?(i.hasClass("stick-panel")||(r.length==0&&(e=document.createElement("div"),e.id=u,document.body.appendChild(e),r=jq("#"+u),r.insertAfter(i),r.css({height:i.css("height"),"padding-bottom":i.css("padding-bottom"),"padding-top":i.css("padding-top")})),r.show(),i.addClass("stick-panel")),i.css("left",i.parent().offset().left-f.scrollLeft())):i.hasClass("stick-panel")&&(r.hide(),i.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto")))},it=function(n){typeof n=="undefined"&&(n=jq(window).width()>=1200||ASC.Desktop);n?jq(".files-content-panel").height()-jq(".mainPageContent").height()<=jq(".mainPageContent").scrollTop()+350&&ASC.Files.Folders.showMore():jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore()},rt=function(){var n=jq("#filesTemplateList .file-row");n.eq(n.length-1).position().top==271&&ASC.Files.Folders.getTemplateList(!0)},ut=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},ft=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&!n.hasClass("to-parent-folder-dropdown")&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position",""));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},et=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},ot=function(n){return n.hasClass("file-locked-by")},st=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},ht=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},ct=function(t){var u=t||jq("#filesMainContent .file-row"),i=jq("#filesMainContent .files-separator").length>0,r;n.setFolder(ASC.Files.Folders.currentFolder.id);r=ASC.Files.UI.autoCleanUpSetting.isAutoCleanUp;u.each(function(){var u=ASC.Files.UI.getObjectData(this),h=u.entryId,f=u.entryType,t=u.entryObject,o=u.title,s,a,e,c,l,v;ASC.Files.Folders.folderContainer=="trash"?(t.find(".file-lock").remove(),t.find(".template-action").remove(),t.find(".entry-descr .title-created").remove(),t.find(".entry-descr .title-removed").show(),f=="folder"&&(t.find(".create-date").remove(),t.find(".modified-date").show()),r?(t.find(".entry-descr .title-removed").remove(),t.find(".create-date").remove(),t.find(".modified-date").remove(),t.find(".deleted-permanently").show(),t.find(".entry-descr .title-removed-permanently").show()):(t.find(".entry-descr .title-removed-permanently").remove(),t.find(".entry-descr .title-removed").show(),t.find(".deleted-permanently-date").remove(),t.find(".modified-date").show())):(t.find(".entry-descr .title-removed").remove(),t.find(".entry-descr .title-removed-permanently").remove(),t.find(".deleted-permanently-date").remove(),f=="folder"&&t.find(".modified-date").remove());s=t.find(".entry-title .name a");a=f=="file"?ASC.Files.Utility.getCssClassByFileTitle(o):ASC.Files.Utility.getFolderCssClass();t.find(".thumb-img, .thumb-"+f).addClass(a);u.thumbnail_status!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(u)||n.setFile(h);u.thumbnail_status==1&&t.find(".thumb-img img").attr("data-src",ASC.Files.Utility.GetFileThumbnailUrl(h,u.version));f!="folder"||ASC.Files.Folders.folderContainer=="forme"||t.hasClass("new-folder")||t.addClass("min");f!="file"||i||ASC.Files.Folders.folderContainer=="forme"||(t.before("<div class='files-separator'><\/div>"),i=!0);t.hasClass("checkloading")||(ASC.Resources.Master.IsAuthenticated||t.addClass("without-share"),f=="file"?(s.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(s,o),ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h,o),s.attr("href",e).attr("target","_blank"),c=t.find(".file-lock"),ASC.Files.UI.accessEdit(u,t)?t.hasClass("file-locked")&&(l=ASC.Files.FilesJSResource.TitleLockedFile,ASC.Files.UI.lockedForMe(t)&&(v=c.attr("data-name"),l=ASC.Files.FilesJSResource.TitleLockedFileBy.format(v),(ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")&&t.addClass("file-can-unlock")),c.attr("title",l)):c.remove()),ASC.Files.Utility.MustConvert(o)&&!u.encrypted?(t.find(".pencil:not(.convert-action)").remove(),(!ASC.Resources.Master.IsAuthenticated||Teamlab.profile.isVisitor)&&!ASC.Files.UI.accessEdit()||ASC.Files.UI.denyDownload(u)||ASC.Files.Folders.folderContainer=="trash"?t.find(".convert-action").remove():t.find(".convert-action").show()):ASC.Files.Utility.CanWebRestrictedEditing(o)&&!u.encrypted?(t.find(".pencil:not(.fillform-action)").remove(),ASC.Files.UI.editableFile(u)?t.find(".fillform-action").show():t.find(".fillform-action").remove()):(u.encrypted&&(ASC.Desktop?(e=ASC.Files.Utility.GetFileWebEditorUrl(h),s.attr("href",e),t.find(".file-edit").attr("href",e)):(s.removeAttr("href"),t.find(".file-edit").removeAttr("href"))),ASC.Files.UI.editableFile(u)&&(!u.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(o)&&ASC.Desktop&&ASC.Desktop.encryptionSupport())?(ASC.Files.UI.lockEditFile(t,ASC.Files.UI.editingFile(t)),t.find(".convert-action, .fillform-action").remove(),ASC.Files.Utility.CanCoAuhtoring(o)&&!t.hasClass("on-edit-alone")&&t.addClass("can-coauthoring"),u.encrypted||(e=ASC.Files.Utility.GetFileWebEditorUrl(h),t.find(".file-edit").attr("href",e))):(t.addClass("cannot-edit"),t.find(".pencil").remove())),u.encrypted&&(ASC.Files.Folders.folderContainer!="privacy"||!ASC.Desktop||!ASC.Desktop.encryptionSupport()||ASC.Resources.Master.Personal)?t.addClass("without-share"):ASC.Resources.Master.Personal&&!ASC.Files.Utility.CanWebView(o)&&t.addClass("without-share")):ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h),s.attr("href",e)),(ASC.Files.Folders.folderContainer=="trash"||u.error)&&s.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")?ASC.Files.Folders.folderContainer!="forme"||u.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite||u.deny_sharing||Teamlab.profile.isVisitor||t.addClass("can-share"):(ASC.Files.Folders.folderContainer=="forme"&&(!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Files.Folders.folderContainer=="privacy"&&(f=="folder"||!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Resources.Master.Personal&&f=="folder"||Teamlab.profile.isVisitor===!0)&&t.addClass("without-share"),jq.browser.msie&&t.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},lt=function(n,t){var r=jq.fixEvent(n);if(!(r.button==0||jq.browser.msie&&r.button==1))return!0;t=t||jq(r.srcElement||r.target);try{if(t.is("a, .menu-small"))return!0}catch(r){return!0}var i=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(i).hasClass("row-selected")||jq(i).find(".checkbox input:visible").is("[type=radio]"),o=!jq(i).find(".checkbox input:visible").prop("disabled");if(r.shiftKey){ASC.Files.UI.lastSelectedEntry||(ASC.Files.UI.lastSelectedEntry=i);u=!0;var f=jq(".file-row").index(i),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),s=Math.min(f,e),h=Math.max(f,e);jq(".file-row:lt("+h+"):gt("+s+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else r.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return o&&(ASC.Files.UI.selectRow(i,u),ASC.Files.UI.updateMainContentHeader()),ASC.Files.UI.lastSelectedEntry=u?{entryObj:i}:null,!0},at=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input[type=checkbox]:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},vt=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},yt=function(n){var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("checked",n===!0||t===!0);jq("#filesSelectAllCheck").prop("indeterminate",t)},pt=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},wt=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"media":t=(ASC.Files.Utility.FileIsAudio(i)||ASC.Files.Utility.FileIsVideo(i))&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},bt=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},kt=function(n,t,i){var r,u,f;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),r=n?n.entryId:null,u=n?n.entryType:null,u=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_RECENT||r==ASC.Files.Constants.FOLDER_ID_FAVORITES||r==ASC.Files.Constants.FOLDER_ID_TEMPLATES||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;f=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);u=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(f=parseInt(ASC.Files.Folders.currentFolder.access));switch(f){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.CustomFilter:case ASC.Files.Constants.AceStatusEnum.Review:case ASC.Files.Constants.AceStatusEnum.FillForms:case ASC.Files.Constants.AceStatusEnum.Comment:return!!i;default:return n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_RECENT||n.entryId===ASC.Files.Constants.FOLDER_ID_FAVORITES||n.entryId===ASC.Files.Constants.FOLDER_ID_TEMPLATES||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)?!1:ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id}},dt=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(ASC.Files.UI.removeEntryObject(n),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},gt=function(n){return!n||!n.deny_download?!1:n.access==ASC.Files.Constants.AceStatusEnum.Read||n.access==ASC.Files.Constants.AceStatusEnum.Comment},ni=function(n){return n?n.access!=ASC.Files.Constants.AceStatusEnum.None&&n.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite?!0:n.access==ASC.Files.Constants.AceStatusEnum.ReadWrite&&n.deny_sharing:!1},ti=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},ii=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResource.TitleEditingFile;i&&(r=ASC.Files.FilesJSResource.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},ri=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:visible:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},ui=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},fi=function(n,t,i){var f;n=n||ASC.Files.UI.getEntryObject(t,i);var h=localStorageManager.getItem(ASC.Files.Constants.storageKeyCompactView)=="thumbnails"?!0:!1,r=ASC.Files.UI.getObjectData(n),c={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length_string:r.content_length_string,thumbnail:r.thumbnail_status==1&&!h?ASC.Files.Utility.GetFileThumbnailUrl(i,r.version):!1,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},l=ASC.Files.Common.jsonToXml(c),a=ASC.Files.TemplateManager.translateFromString(l),u=n.find(".checkbox"),e=jq("#entryTooltip"),o=jq(window),s=12;e.html(a);f=u.offset().top+u.outerHeight()+e.outerHeight()+s>o.height()+o.scrollTop();jq.dropdownToggle().toggle(u,"entryTooltip",f?s:0,0,!1,null,null,null,f)},ei=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},oi=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):(ASC.Files.Folders.folderContainer||!ASC.Resources.Master.IsAuthenticated)&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},si=function(n,t){var r=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1&&ASC.Files.Tree.getParentId(ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-1]),e,i;if(r){if(e=ASC.Files.Tree.getFolderTitle(r),jq(n).attr("data-id",r).attr("href",ASC.Files.UI.getEntryLink("folder",r)).attr("title",e),n==".to-parent-folder-dropdown"){var f=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-1],o=ASC.Files.Tree.getFolderTitle(f),u=jq("#filesBreadCrumbs");u.find(".rename-action").remove();u.find("#promptRenameParentFolder").hide();u.find(".to-parent-folder-link").show().find(".inner-ellipsis").text(o);u.find("#linkCurrentFolder").attr("href",ASC.Files.UI.getEntryLink("folder",f));i=ASC.Files.Tree.getFolderData(f);jq(n).attr("title",o).children('input[name="entry_data"]').attr("data-deny_download",i.deny_download).attr("data-deny_sharing",i.deny_sharing).attr("data-access",i.access).attr("data-shared",i.shared).attr("data-id",i.id).attr("data-create_by_id",i.create_by_id).attr("data-title",i.title).attr("data-folder_id",i.folder_id).attr("data-provider_key",i.provider_key).attr("data-provider_id",i.provider_id).attr("data-parent_folder_id",r)}jq(t||n).show()}else jq(t||n).hide(),ASC.Files.UI.removeDataFromButtonBack()},hi=function(){jq(".to-parent-folder-dropdown").children('input[name="entry_data"]').attr("data-deny_download","").attr("data-deny_sharing","").attr("data-access","").attr("data-shared","").attr("data-id","").attr("data-create_by_id","").attr("data-title","").attr("data-folder_id","").attr("data-provider_key","").attr("data-provider_id","").attr("data-parent_folder_id","");jq(".to-parent-folder-link .inner-ellipsis").text("")},ci=function(n){jq(n).off("keyup").on("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},li=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ai=function(n){ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView&&ASC.Files.MediaPlayer.closePlayer();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"),jq("#mainContentHeader, .files-filter").hide());jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon, #settingAdmin").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},vi=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},yi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsCommon)},pi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-admin").addClass("active");jq("#settingAdmin").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsAdmin)},wi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleMoreFeaturs)},bi=function(){return jq("#personalLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#personalLimitExceedStoragePanel",500),!0):!1},ki=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500),!0):!1},di=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500),!0):!1},gi=function(n,t){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t)},nr=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},tr=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&u.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:f,parseItemId:v,removeEntryObject:s,getEntryObject:h,getObjectData:l,setObjectData:a,getSelectorId:c,getEntryTitle:y,getObjectTitle:p,getEntryLink:w,currentPage:0,amountPage:0,countTotal:0,autoCleanUpSetting:null,updateFolderView:b,switchFolderView:k,isSettingsPanel:d,blockObjectById:ut,blockObject:ft,highlightExtension:ht,addRowHandlers:ct,updateMainContentHeader:at,lastSelectedEntry:null,checkSelectAll:pt,checkSelect:wt,selectRow:vt,clickRow:lt,resetSelectAll:yt,displayInfoPanel:bt,editingFile:et,editableFile:st,lockedForMe:ot,checkEditing:ri,timeCheckEditing:null,checkEditingDefer:ui,lockEditFileById:ti,lockEditFile:ii,accessEdit:kt,accessDelete:dt,denyDownload:gt,denySharing:ni,checkCharacter:ci,canSetDocumentTitle:!0,setDocumentTitle:li,stickContentHeader:nt,fixContentHeaderWidth:g,stickMovingPanel:tt,trackShowMore:it,trackShowMoreTemplates:rt,displayEntryTooltip:fi,hideEntryTooltip:ei,timeTooltip:null,removeDataFromButtonBack:hi,checkEmptyContent:oi,checkButtonBack:si,hideAllContent:ai,displayHelp:vi,displayCommonSetting:yi,displayAdminSetting:pi,displayMoreFeaturs:wi,displayPersonalLimitStorageExceed:bi,displayTariffLimitStorageExceed:ki,displayTariffFileSizeExceed:di,blockUI:gi,setProgressValue:nr,filesSelectedHandler:o,registerUserProfilePopup:tr}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").on("click",function(){ASC.Files.UI.switchFolderView("normal")});jq("#switchToCompact").on("click",function(){ASC.Files.UI.switchFolderView("compact")});jq("#switchToThumbnails").on("click",function(){ASC.Files.UI.switchFolderView("thumbnails")});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).trigger("blur");ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").on("click",function(){return jq(document).scrollTop(0),document.querySelector(".mainPageContent").scrollTo(0,0),!1});jq(document).on("keydown",function(n){var t,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);i=t.target||t.srcElement;try{if(jq(i).is("input,textarea"))return!0}catch(t){return!0}return(r=t.keyCode||t.which,r==ASC.Files.Common.keyCode.A&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").trigger("focus")},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).on("keyup",function(n){var t,u,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);u=t.target||t.srcElement;try{if(jq(u).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey&&!t.altKey)return ASC.Files.Folders.deleteItem(),!1;if(i==ASC.Files.Common.keyCode.F&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if(i==ASC.Files.Common.keyCode.N&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1;i==ASC.Files.Common.keyCode.F2&&jq("#filesMainContent .file-row.row-selected:visible").length==1&&(r=ASC.Files.UI.getObjectData(jq("#filesMainContent .file-row.row-selected")),ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.rename(r.entryType,r.id))}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()})})}(jQuery);
window.ASC.Files.EventHandler=function(){var r=!1,t=null,f=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.EventHandler.onGetFolderItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetItems,ASC.Files.EventHandler.onGetItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CheckEditing,ASC.Files.EventHandler.onCheckEditing),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.LockFile,ASC.Files.EventHandler.onLockFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateIfExist,ASC.Files.EventHandler.onUpdateIfExist),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.EventHandler.onGetHelpCenter),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateFolder,ASC.Files.EventHandler.onCreateFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateNewFile,ASC.Files.EventHandler.onCreateNewFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FolderRename,ASC.Files.EventHandler.onRenameFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FileRename,ASC.Files.EventHandler.onRenameFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeOwner,ASC.Files.EventHandler.onChangeOwner),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.EventHandler.onGetFileHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetCurrentVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CompleteVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ReplaceVersion,ASC.Files.EventHandler.onGetFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateComment,ASC.Files.EventHandler.onUpdateComment),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveFilesCheck,ASC.Files.EventHandler.onMoveFilesCheck),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTemplates,ASC.Files.EventHandler.onGetTemplates),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveItems,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteItem,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.EmptyTrash,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.Download,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.TerminateTasks,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTasksStatuses,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeExternalShareSettings,ASC.Files.EventHandler.onChangeExternalShareSettings),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeExternalShareSocialMediaSettings,ASC.Files.EventHandler.onChangeExternalShareSocialMediaSettings))},e=function(t,i,r){var u,f,e;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.Tree&&ASC.Files.Tree.resetFolder(ASC.Files.Tree.getParentId(i.folderId));ASC.Files.Anchor.defaultFolderSet();return}if(!o(t.getElementsByTagName("folder_info")[0])){ASC.Files.Anchor.defaultFolderSet();return}if(!s(t.getElementsByTagName("path_parts")[0])){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.Marker&&ASC.Files.Marker.markRootAsNew(t.getElementsByTagName("root_folders_id_marked_as_new")[0]);u=t.getElementsByTagName("total")[0];ASC.Files.UI.countTotal=parseInt(u.text||u.textContent)||0;i.append||(jq("#filesMainContent").empty(),jq(document).scrollTop(0),ASC.Files.Folders.folderContainer!="forme"&&jq("#filesMainContent").append("<div class='folders-separator'><\/div>"));f=ASC.Files.TemplateManager.translate(t);n(f);f!==""&&ASC.Files.Filter&&(e=ASC.Files.Filter.getFilterSettings()).isSet?(jq("#filesBreadCrumbs").is(":visible")||(jq("#filesBreadCrumbs").show(),jq(".to-parent-folder").hide()),jq("#filesBreadCrumbs").addClass("with-search-crumbs"),jq("#searchBreadCrumbs").attr("data-id",ASC.Files.Folders.currentFolder.id).attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)).attr("title",ASC.Files.Folders.currentFolder.title).text(ASC.Files.Folders.currentFolder.title),jq("#searchBreadCrumbsSub").toggle(e.withSubfolders&&(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty()))):jq("#filesBreadCrumbs").removeClass("with-search-crumbs");jq(ASC.Files.UI.lastSelectedEntry).each(function(){var n=ASC.Files.UI.getEntryObject(this.entryType,this.entryId);ASC.Files.UI.selectRow(n,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null);ASC.Files.CreateMenu&&(ASC.Desktop||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PRIVACY&&ASC.Files.Folders.folderContainer!="privacy"?ASC.Files.CreateMenu.disableMenu(ASC.Files.UI.accessEdit()):ASC.Files.CreateMenu.disableMenu(!1));ASC.Files.UI.stickContentHeader()},n=function(n,t){var f,i,r,u,e,o;return ASC.Files.UI.resetSelectAll(),ASC.Files.EmptyScreen.hideEmptyScreen(),n==""?t||ASC.Files.EmptyScreen.displayEmptyScreen():(t?t.length?(f=t.hasClass("row-selected")||t.attr("data-selected")=="true",t.after(n),i=t.next(),i.toggleClass("min",t.hasClass("min")),ASC.Files.UI.removeEntryObject(t)):(jq("#filesMainContent").prepend(n),i=jq('#filesMainContent .file-row[name="addRow"][data-id!="folder_0"][data-id!="file_0"]')):(jq("#filesMainContent").append(n),i=jq("#filesMainContent .file-row:gt(-"+(ASC.Files.Constants.COUNT_ON_PAGE+1)+")")),jq('#filesMainContent .file-row[name="addRow"]').each(function(){var n=ASC.Files.UI.getObjectData(this),t=ASC.Files.UI.getEntryObject(n.entryType,n.id);t.filter('[name!="addRow"]').remove()}),r=parseInt(ASC.Files.Constants.COUNT_ON_PAGE)||0,ASC.Files.UI.amountPage=parseInt((ASC.Files.UI.countTotal/r).toFixed(0)),ASC.Files.UI.amountPage-ASC.Files.UI.countTotal/r<0&&ASC.Files.UI.amountPage++,ASC.Files.UI.currentPage=parseInt((jq('#filesMainContent .file-row[name!="addRow"]').length-1)/r)+1,u=ASC.Files.UI.countTotal-jq("#filesMainContent .file-row").length,ASC.Files.UI.currentPage<ASC.Files.UI.amountPage&&u>0?(jq("#pageNavigatorHolder").show(),ASC.Files.FilesJSResource&&jq("#pageNavigatorHolder a").text(r<u?ASC.Files.FilesJSResource.ButtonShowMoreOf.format(r,u):ASC.Files.FilesJSResource.ButtonShowMore.format(u))):jq("#pageNavigatorHolder").hide(),ASC.Files.Mouse&&ASC.Files.Mouse.collectEntryItems(),ASC.Files.UI.addRowHandlers(i),f&&(ASC.Files.UI.selectRow(i,f),ASC.Files.UI.updateMainContentHeader()),e=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),e.length>0&&(o=jq(e).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray(),ASC.Files.Socket.subscribeChangeEditors(o)),ASC.Files.UI.checkEditingDefer()),i&&i.attr("name",""),i},o=function(n){var t,i;if(typeof n=="undefined"||n==null)return!1;if(!ASC.Files.Folders)return!0;ASC.Files.Folders.currentFolder={};t=jq(n.childNodes);for(i in t)i&&typeof t[i]=="object"&&(ASC.Files.Folders.currentFolder[t[i].tagName]=t[i].textContent||t[i].text||"");if(ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))ASC.Files.Folders.currentFolder.entryId=ASC.Files.Folders.currentFolder.id;else return!1;if(ASC.Files.Folders.currentFolder.entryType="folder",ASC.Files.Share){if(ASC.Files.Folders.currentFolder.access=parseInt(ASC.Files.Folders.currentFolder.access||ASC.Files.Constants.AceStatusEnum.None),ASC.Files.Folders.currentFolder.access==ASC.Files.Constants.AceStatusEnum.Restrict)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1;ASC.Files.Folders.currentFolder.shareable=ASC.Files.Folders.currentFolder.shareable==="true"}return ASC.Files.Tree&&ASC.Files.Folders.currentFolder.id==ASC.Files.Tree.folderIdCurrentRoot&&(ASC.Files.Folders.currentFolder.title=ASC.Files.FilesJSResource.ProjectFiles),ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title),!0},s=function(n){var t,i;if(typeof n=="undefined"||n==null||(t=jq(n.childNodes).map(function(n,t){var i=t.childNodes[0];return i.textContent||i.text}),t.length==0))return!1;i=parseInt(t[0]);ASC.Files.Tree&&(ASC.Files.Tree.pathParts=t);jq("#mainContentHeader .menuAction").removeClass("unlockAction").hide();jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("recentFiles").removeClass("favoritesFiles").removeClass("templatesFiles").removeClass("privacyFiles").removeClass("trashFiles").removeClass("projectFiles");switch(i){case ASC.Files.Constants.FOLDER_ID_MY_FILES:ASC.Files.Folders.folderContainer="my";jq("#filesMainContent").addClass("myFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_SHARE:ASC.Files.Folders.folderContainer="forme";jq("#filesMainContent").addClass("shareformeFiles");jq("#mainDownload, #mainCopy, #mainMarkRead, #mainUnsubscribe, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_RECENT:ASC.Files.Folders.folderContainer="recent";jq("#filesMainContent").addClass("recentFiles");jq("#mainDownload, #mainCopy, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_FAVORITES:ASC.Files.Folders.folderContainer="favorites";jq("#filesMainContent").addClass("favoritesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveFavorite").show();break;case ASC.Files.Constants.FOLDER_ID_TEMPLATES:ASC.Files.Folders.folderContainer="templates";jq("#filesMainContent").addClass("templatesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveTemplate").show();break;case ASC.Files.Constants.FOLDER_ID_PRIVACY:ASC.Files.Folders.folderContainer="privacy";jq("#filesMainContent").addClass("privacyFiles");jq("#mainDownload, #mainMove, #mainDelete").show();break;case ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Folders.folderContainer="corporate";jq("#filesMainContent").addClass("corporateFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_PROJECT:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_TRASH:ASC.Files.Folders.folderContainer="trash";jq("#filesMainContent").addClass("trashFiles");jq("#mainDownload, #mainRestore, #mainDelete, #mainEmptyTrash, #mainConvert").show();jq("#mainEmptyTrash").addClass("unlockAction");break;case ASC.Files.Tree.folderIdCurrentRoot:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;default:if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))return!1}return ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&ASC.Files.Folders.folderContainer!="privacy"&&!ASC.Resources.Master.Personal&&jq("#mainShare").show(),ASC.Resources.Master.IsAuthenticated||(jq("#mainShare, #mainMarkRead, #mainDelete, #mainMove, #mainCopy").hide(),jq("#mainDownload, #mainConvert").show(),ASC.Files.Folders.currentFolder.access===ASC.Files.Constants.AceStatusEnum.ReadWrite&&jq("#mainMove, #mainCopy").show()),ASC.Files.Filter&&ASC.Files.Filter.disableFilter(),jq("#filesMainContent").toggleClass("without-share",!(ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable)),ASC.Files.Tree&&ASC.Files.Tree.updateTreePath(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),ASC.Files.UI.checkButtonBack(".to-parent-folder-dropdown","#filesBreadCrumbs"),!0},h=function(t,i,r){var e,u,o,f,s;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.parentFolderID){for(i.lonelyType&&(t.__type=i.lonelyType,t=[t]),e="",u=0;u<t.length;u++)o=ASC.Files.Common.jsonToXml(t[u].__type.toLowerCase().indexOf("folder")==-1?{file:t[u]}:{folder:t[u]}),e+=ASC.Files.TemplateManager.translateFromString(o);f=n(e,{});f&&(s=f.hasClass("new-folder"),f.removeClass("new-file new-folder").show().yellowFade(),ASC.Files.Tree&&s&&ASC.Files.Tree.resetFolder(i.parentFolderID))}},c=function(t,i,r){var h=ASC.Files.UI.getEntryObject("file","0"),u,c,f;if(ASC.Files.UI.blockObject(h),u=i.winEditor,typeof r!="undefined"){ASC.Files.UI.removeEntryObject(h);u&&u.close();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}if(c=ASC.Files.TemplateManager.translate(t),ASC.Files.Folders.currentFolder.id==i.folderID){f=n(c,h);f.show().yellowFade().removeClass("new-file");var e=ASC.Files.UI.getObjectData(f),s=e.title,o=e.entryId;if(ASC.Files.Folders.folderContainer=="privacy"&&ASC.Desktop&&ASC.Desktop.setAccess){ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResource.DescriptCreate);ASC.Desktop.setAccess(o,function(n){n?(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.DesktopMessageStoring),ASC.Files.Folders.replaceFileStream(o,s,n,!0,u)):(ASC.Files.UI.blockObject(f),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(s)))});return}u!==!1&&ASC.Files.Actions.checkEditFile(o,u)}else f=jq(c),e=ASC.Files.UI.getObjectData(f),s=e.title,o=e.entryId,u!==!1&&ASC.Files.Actions.checkEditFile(o,u);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(s))},l=function(t,i,r){var e=ASC.Files.UI.getEntryObject("folder","0"),o,u,f;if(typeof r!="undefined"){ASC.Files.UI.removeEntryObject(e);jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}ASC.Files.Folders.currentFolder.id==i.parentFolderID?(o=ASC.Files.TemplateManager.translate(t),u=n(o,e),u.yellowFade().removeClass("new-folder"),f=ASC.Files.UI.getObjectData(u).title):f=i.title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFolder.format(f))},a=function(t,i,r){var f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var e=ASC.Files.TemplateManager.translate(t),o=i.folderId,u=ASC.Files.UI.getEntryObject("folder",o);u.is(".to-parent-folder-dropdown")||(u=n(e,u),u.yellowFade().removeClass("new-folder"),ASC.Files.UI.selectRow(u,!0),ASC.Files.UI.updateMainContentHeader());f=ASC.Files.UI.getObjectData(u).title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRenameFolder.format(i.name,f))},v=function(n,t,i){var r,u;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=ASC.Files.EventHandler.onGetFile(n,t,i);ASC.Files.UI.selectRow(r.entryObject,!0);ASC.Files.UI.updateMainContentHeader();u=r.title;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRenameFile.format(t.name,u))},y=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u,f;jq(i.list).each(function(e,o){var h=ASC.Files.UI.parseItemId(o),l,v,c;if(jq(t).each(function(n,t){return t.id==h.entryId?(l=t,!1):!0}),h.entryType=="folder"){var a=ASC.Files.Common.jsonToXml({folder:l}),y=ASC.Files.TemplateManager.translateFromString(a),p=h.entryId,s=ASC.Files.UI.getEntryObject("folder",p);s=n(y,s);s.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(s,!0);ASC.Files.UI.updateMainContentHeader();ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);v=ASC.Files.UI.getObjectData(s);u=v.create_by;f=v.title}else a=ASC.Files.Common.jsonToXml({file:l}),c=ASC.Files.EventHandler.onGetFile(a,{fileId:h.entryId,isStringXml:!0,show:!0},r),ASC.Files.UI.selectRow(c.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),u=c.create_by,f=c.title});i.list.length>1?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoChangeOwnerArray.format(Encoder.htmlEncode(u),i.list.length)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoChangeOwner.format(Encoder.htmlEncode(u),f))},p=function(n,t,i){var f=t.fileId,e=ASC.Files.UI.getEntryObject("file",f),r,u;if(typeof i!="undefined"){ASC.Files.UI.blockObject(e);jq(".version-operation").css("visibility","");ASC.Files.UI.displayInfoPanel(i,!0);return}jq.extend(t,{isStringXml:!0,show:!0});r=ASC.Files.Common.jsonToXml({file:n.key});ASC.Files.EventHandler.onGetFile(r,t);u=ASC.Files.Common.jsonToXml({fileList:{entry:n.value}});ASC.Files.EventHandler.onGetFileHistory(u,t)},w=function(n,t,i){var l=t.fileId,r=ASC.Files.UI.getEntryObject("file",l),s,u,e,f,h,c,o;if(ASC.Files.UI.blockObject(r),ASC.Files.UI.updateMainContentHeader(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(s=t.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(n):ASC.Files.TemplateManager.translate(n),jq("#contentVersions").remove(),jq(".display-versions").removeClass("display-versions"),jq("#filesMainContent").hasClass("thumbnails")){for(u=r;;){if(e=u.next(),!e.length)break;if(e.position().top!=u.position().top)break;u=e}u.after(s)}else r.append(s).addClass("file-row-fix");r.addClass("display-versions");f=ASC.Files.UI.getObjectData(r);h=!0;!ASC.Files.UI.accessEdit(f,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r)||Teamlab.profile.isVisitor||f.encrypted?(jq(".version-comment-edit").remove(),jq(".version-operation.version-restore").empty(),jq(".version-complete, .version-continue").remove(),jq(".version-num span").addClass("display-num"),h=!1):jq("#contentVersions").addClass("version-edit");f.deny_download&&jq(".version-download").remove();jq("#contentVersions").addClass("version-highlight");ASC.Files.Utility.CanWebView(f.title)&&jq(".not-preview").removeClass("not-preview");c=jq("#contentVersions .version-row:first").attr("data-version");jq("#contentVersions .version-row[data-version='"+c+"'] .version-restore").empty();o=-1;jq("#contentVersions .version-row").each(function(){var n=jq(this),i=n.attr("data-version-group"),r=n.attr("data-version"),t;i!=o?(r==c?n.find(".version-continue").remove():n.find(".version-complete").remove(),o=i,n.addClass("version-group-head"),t=jq("#contentVersions .version-row[data-version-group="+o+"]"),t.length>1&&n.find(".version-sublist span").addClass("version-sublist-toggle").text(jq.format(ASC.Files.FilesJSResource.RevisionCount,t.length))):h?n.find(".version-num span, .version-continue").remove():n.find(".version-num").empty()});ASC.Resources.Master.IsAuthenticated&&ASC.Files.UI.registerUserProfilePopup(jq("#contentVersions"))},b=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}n=n||"";jq("#contentVersions .version-row[data-version="+t.version+"]").removeClass("version-row-comment").find(".version-comment").attr("data-comment",n).attr("title",n.length?n:"").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>")},k=function(t,i,r){var e,o,u,f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(e=i.fileId,ASC.Files.Common.isCorrectId(e))return o=i.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(t):ASC.Files.TemplateManager.translate(t),ASC.Files.Marker.removeNewIcon("file",e),u=ASC.Files.UI.getEntryObject("file",e),u=n(o,u),f=ASC.Files.UI.getObjectData(u),!f||(u=f.entryObject,i.show&&(ASC.Files.EmptyScreen.hideEmptyScreen(),u.removeClass("new-file").show().yellowFade()),u.find(".is-new").is(":visible")&&ASC.Files.Marker.setNewCount(f.entryType,f.entryId,1)),ASC.Files.UI.updateMainContentHeader(),f},d=function(n,t,i){if(typeof i!="undefined"){jq(t.list.entry).each(function(){var n=ASC.Files.UI.parseItemId(this);ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.displayInfoPanel(i,!0);return}n!=null&&n.length>0?ASC.Files.Folders.showOverwriteMessage(t.list,t.folderToId,t.folderToTitle,t.isCopyOperation,n):(ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t.folderToId,resolve:ASC.Files.Constants.ConflictResolveType.Duplicate,isCopyOperation:t.isCopyOperation,doNow:!0},{stringList:t.list}),ASC.Files.Folders.isCopyTo=!1)},u=function(n,t,i,r){var o=ASC.Files.UI.parseItemId(n[0]).entryId,f,s,u,h,c,a,p,w,k,b;for(n=n.slice(1),f=[],s=[],u=0;u<n.length;u++)(h=ASC.Files.UI.parseItemId(n[u]),h!=null)&&(u%2?s.push(h):(f.push(h),ASC.Files.UI.blockObjectById(h.entryType,h.entryId,!1,null,!0)));ASC.Files.UI.updateMainContentHeader();c=ASC.Files.UI.getEntryObject("folder",o);c.removeClass("row-to");var v,y=0,l=0,e="";for(f.length==1&&(e=ASC.Files.UI.getEntryTitle(f[0].entryType,f[0].entryId),(typeof e==undefined||e==null)&&(e="")),u=0;u<f.length;u++)a=ASC.Files.UI.getEntryObject(f[u].entryType,f[u].entryId),f[u].entryType=="file"?l++:(y+=1+(parseInt(a.find(".countFolders").html())||0),l+=parseInt(a.find(".countFiles").html())||0,ASC.Files.Tree&&!v&&(v=ASC.Files.Tree.getParentId(f[u].entryId))),t||ASC.Files.Folders.currentFolder.id==o||(ASC.Files.Marker.removeNewIcon(f[u].entryType,f[u].entryId),ASC.Files.UI.removeEntryObject(a));if(y>0&&(p=c.find(".countFolders"),p.html((parseInt(p.html())||0)+y),ASC.Files.Tree&&(ASC.Files.Tree.reloadFolder(o),t||o==ASC.Files.Folders.currentFolder.id||ASC.Files.Tree.reloadFolder(v||ASC.Files.Folders.currentFolder.id))),l>0&&(w=c.find(".countFiles"),k=ASC.Files.Folders.owerwriteManager.get(t,r),w.html((parseInt(w.html())||0)+l-k)),f.length>0&&ASC.Files.Folders.currentFolder.id!=o&&ASC.Files.UI.checkEmptyContent(),t?f.length==1&&e!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCopyItem.format(e)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCopyGroup.format(i)):f.length==1&&e!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveItem.format(e)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveGroup.format(i)),ASC.Files.Folders.currentFolder.id==o){for(b=[],u=0;u<s.length;u++)ASC.Files.UI.getEntryObject(s[u].entryType,s[u].entryId).length||b.push(s[u].entryType+"_"+s[u].entryId);ASC.Files.Folders.getItems(b,o)}},g=function(n,t){var s=ASC.Files.UI.parseItemId(n[0]).entryId,i,r,f,c;for(n=n.slice(1),i=[],r=0;r<n.length;r++)(f=ASC.Files.UI.parseItemId(n[r]),f!=null)&&(i.push(f),ASC.Files.UI.blockObjectById(f.entryType,f.entryId,!1,null,!0));ASC.Files.UI.updateMainContentHeader();var o,e=!1,u="",h=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>0&&(ASC.Files.Tree.pathParts[0]!=ASC.Files.Constants.FOLDER_ID_TRASH||s==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty());for(i.length==1&&(u=ASC.Files.UI.getEntryTitle(i[0].entryType,i[0].entryId),(typeof u==undefined||u==null)&&(u="")),r=0;r<i.length;r++)c=ASC.Files.UI.getEntryObject(i[r].entryType,i[r].entryId),i[r].entryType=="folder"&&(e||(e=!0),ASC.Files.Tree&&!o&&(o=ASC.Files.Tree.getParentId(i[r].entryId))),h&&(ASC.Files.Marker.removeNewIcon(i[r].entryType,i[r].entryId),ASC.Files.UI.removeEntryObject(c),ASC.Files.ChunkUploads.removeUploadItemByFileId(i[r].entryId));e&&ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(o||ASC.Files.Folders.currentFolder.id);i.length>0&&h&&ASC.Files.UI.checkEmptyContent();i.length==1&&u!=""?e>0?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveFolder.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveFile.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveGroup.format(i.length,t));s==ASC.Files.Constants.FOLDER_ID_TRASH&&ASC.Files.ChunkUploads.initTenantQuota()},nt=function(n,t,i){var s,u,e,o,r,c;if(clearTimeout(ASC.Files.UI.timeCheckEditing),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}for(n||(n=[]),s=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),u=0;u<s.length;u++){var h=ASC.Files.UI.getObjectData(s[u]),l=h.entryObject,f=h.entryId;for(ASC.Files.UI.lockEditFile(l,!1),e=!0,o=0;o<n.length&&e;o++)f==n[o].Key&&(e=!1);e&&ASC.Files.Folders.replaceVersion(f,!0)}for(r=0;r<n.length;r++)f=n[r].Key,c=n[r].Value,ASC.Files.UI.lockEditFileById(f,!0,c);n.length>0&&ASC.Files.UI.checkEditingDefer()},tt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq(".update-if-exist").prop("checked",n===!0)},it=function(n,t,i){var u,r;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}u=t.lock;u?(r=t.fileObj,r.addClass("file-locked"),ASC.Files.UI.addRowHandlers(r)):(t.show=!0,ASC.Files.Actions.currentEntryData=ASC.Files.EventHandler.onGetFile(n,t,i))},rt=function(n,t,i){if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Actions.hideAllActionPanels();return}jq("#filesTemplateLoader").hide();var r=ASC.Files.TemplateManager.translate(n),u=!r.length;(t.append||(jq("#filesTemplateEmpty").toggle(u),jq("#filesTemplateList").toggle(!u)),u)||(t.append?jq("#filesTemplateList").append(r):jq("#filesTemplateList").html(r),jq("#filesTemplateList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-img, .thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")}))},ut=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Anchor.defaultFolderSet();return}t.update&&(jq("#helpPanel").html(n),StudioManager.initImageZoom());LoadingBanner.hideLoading();jq("#helpPanel").show();showHelpPage(t.helpId);ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsHelp);ASC.Files.CreateMenu.disableMenu()},ft=function(n,r,f){var h,o,e;if(typeof n!="object"&&typeof f!="undefined"||n==null){ASC.Files.Folders.cancelTasksStatuses();ASC.Files.UI.displayInfoPanel(f,!0);return}if(n.length==0){ASC.Files.Folders.cancelTasksStatuses();return}var s=0,c=!1,l,a=[ASC.Files.FilesJSResource.TasksOperationMove,ASC.Files.FilesJSResource.TasksOperationCopy,ASC.Files.FilesJSResource.TasksOperationDelete,ASC.Files.FilesJSResource.TasksOperationBulkdownload,ASC.Files.FilesJSResource.TasksOperationMarkAsRead],v=[ASC.Files.FilesJSResource.DescriptMove,ASC.Files.FilesJSResource.DescriptCopy,ASC.Files.FilesJSResource.DescriptRemove,ASC.Files.FilesJSResource.DescriptBulkdownload,ASC.Files.FilesJSResource.DescriptMarkAsRead];for(n.length!=0&&(jq("#tasksProgress:visible").length==0&&(clearTimeout(t),jq("#tasksProgress").length==0&&(jq("#progressTemplate").clone().attr("id","tasksProgress").prependTo("#bottomLoaderPanel"),jq("#tasksProgress .progress-dialog-header").append('<a title="{0}" class="actions-container close">&times;<\/a>'.format(ASC.Files.FilesJSResource.TitleCancel)),jq("#tasksProgress .progress-dialog-header").append("<span><\/span>")),ASC.Files.UI.setProgressValue("#tasksProgress",0),jq("#tasksProgress .asc-progress-percent").text("0%"),jq("#tasksProgress .progress-dialog-header span").text(""),jq("#tasksProgress").show(),jq.browser.mobile&&(jq("#bottomLoaderPanel").css("bottom","auto"),jq("#bottomLoaderPanel").css("top",jq(window).scrollTop()+jq(window).height()-jq("#bottomLoaderPanel").height()+"px"))),l=n.length>1?ASC.Files.FilesJSResource.TasksOperationMixed.format(n.length):a[n[0].operation],jq("#tasksProgress .progress-dialog-header span").text(l)),i=0;i<n.length;i++)if(h=":",o=n[i].source.trim().split(h),jq(o).each(function(){var t=ASC.Files.UI.parseItemId(this);if(t==null)return!0;ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!0,v[n[i].operation],!0)}),ASC.Files.UI.updateMainContentHeader(),s+=n[i].progress,n[i].finished){if(n[i].result!=null){e=n[i].result.trim().split(h);switch(n[i].operation){case 0:u(e,!1,n[i].processed,o);break;case 1:u(e,!0,n[i].processed,o);break;case 2:g(e,o.length);break;case 3:e[0]&&n[i].error==null&&(location.href=e[0]);ASC.Files.Folders.bulkStatuses=!1;break;case 4:ASC.Files.Marker.onMarkAsRead(e)}}jq(o).each(function(){var n=ASC.Files.UI.parseItemId(this);if(n==null)return!0;ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();n[i].error!=null&&ASC.Files.UI.displayInfoPanel(n[i].error,!0)}else c=!0;s=n.length==0?100:s/n.length;ASC.Files.UI.setProgressValue("#tasksProgress",s);jq("#tasksProgress .asc-progress-percent").text(s+"%");c?ASC.Files.Folders.getTasksStatuses(r.doNow):(clearTimeout(t),t=setTimeout(ASC.Files.Folders.cancelTasksStatuses,500))},et=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var r=n===!0;jq("#cbxExternalShare").prop("checked",r);r?jq("#cbxExternalShareSocialMedia").prop("disabled",!1).next().removeClass("gray-text"):jq("#cbxExternalShareSocialMedia").prop("disabled",!0).prop("checked",!1).next().addClass("gray-text");ASC.Files.Share&&ASC.Files.Share.changeExternalShareSettings()},ot=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#cbxExternalShareSocialMedia").prop("checked",n===!0);ASC.Files.Share&&ASC.Files.Share.changeExternalShareSettings()},st=function(){jq.browser.msie||(this.parentElement.style.backgroundSize="96px",this.parentElement.removeChild(this))};return{init:f,onGetFolderItems:e,onGetItems:h,onGetFile:k,onCreateNewFile:c,onCreateFolder:l,onRenameFolder:a,onRenameFile:v,onChangeOwner:y,onUpdateHistory:p,onGetFileHistory:w,onUpdateComment:b,onCheckEditing:nt,onLockFile:it,onGetTemplates:rt,onUpdateIfExist:tt,onGetHelpCenter:ut,onMoveFilesCheck:d,onGetTasksStatuses:ft,onChangeExternalShareSettings:et,onChangeExternalShareSocialMediaSettings:ot,onThumbnailError:st,insertFolderItems:n}}(),function(n){n(function(){ASC.Files.EventHandler.init();jq("#bottomLoaderPanel").on("click","#tasksProgress a.close",function(){return ASC.Files.Folders.terminateTasks(),!1})})}(jQuery);
window.ASC.Files.Anchor=function(){var t=!1,n={error:new RegExp("^error(?:/(\\S+))?"),message:new RegExp("^message(?:/(\\S+))?"),preview:new RegExp("^preview(?:/|%2F)"+ASC.Files.Constants.entryIdRegExpStr),setting:new RegExp("^setting(?:=?(\\w+)?)?"),folder:new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr),help:new RegExp("^help(?:=(\\d+))?"),more:new RegExp("^more"),anyanchor:new RegExp("^(\\S+)?")},r=function(){t===!1&&(t=!0,ASC.Files.Folders&&(ASC.Controls.AnchorController.bind(n.anyanchor,u),ASC.Controls.AnchorController.bind(n.error,f),ASC.Controls.AnchorController.bind(n.message,e),ASC.Controls.AnchorController.bind(n.folder,s),ASC.Controls.AnchorController.bind(n.preview,h),ASC.Controls.AnchorController.bind(n.setting,l),ASC.Controls.AnchorController.bind(n.help,c),ASC.Controls.AnchorController.bind(n.more,o)))},u=function(t){n.error.test(t)||n.message.test(t)||n.preview.test(t)||n.setting.test(t)||n.folder.test(t)||n.help.test(t)||n.more.test(t)||ASC.Files.Anchor.defaultFolderSet()},f=function(n){ASC.Files.UI.displayInfoPanel(decodeURIComponent(n||ASC.Files.FilesJSResource.UnknownErrorText).replace(/\+/g," "),!0);jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},e=function(n){n.length&&ASC.Files.UI.displayInfoPanel(decodeURIComponent(n).replace(/\+/g," "));jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},o=function(){ASC.Files.UI.displayMoreFeaturs()},s=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));ASC.Files.Folders.currentFolder.id=ASC.Files.Common.isCorrectId(n)?n:"";ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.updateFolderView()},h=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));typeof ASC.Files.MediaPlayer!="undefined"?ASC.Files.MediaPlayer.init(n,{allowConvert:!0,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(n){ASC.Files.Marker.removeNewIcon("file",n);var t=ASC.Files.MediaPlayer.getPlayHash(n);ASC.Files.Anchor.move(t,!0)},downloadAction:ASC.Files.Utility.GetFileViewUrl,canDelete:function(n){var t=ASC.Files.UI.getEntryObject("file",n);return t.length<=0?!1:!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)?!1:!0},deleteAction:function(n,t){ASC.Files.Folders.deleteItem("file",n,t)}}):ASC.Files.Anchor.defaultFolderSet()},c=function(n){ASC.Files.UI.displayHelp(n)},l=function(n){switch(n){case"thirdparty":if(ASC.Files.ThirdParty)location.hash.indexOf("code")!=-1&&(ASC.Files.Folders.eventAfter=ASC.Files.ThirdParty.processAnchor),ASC.Files.ThirdParty.showSettingThirdParty();else{ASC.Files.Anchor.defaultFolderSet();return}break;case"admin":if(!ASC.Files.Constants.ADMIN){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.displayAdminSetting();break;default:ASC.Files.UI.displayCommonSetting()}ASC.Files.CreateMenu.disableMenu()},a=function(n,t){n=ASC.Files.Common.getCorrectHash(n);t?ASC.Controls.AnchorController.safemove(n):ASC.Controls.AnchorController.move(n)},i=function(n,t){ASC.Files.Common.isCorrectId(n)||(n=ASC.Files.Folders.currentFolder.id);jq("#filesMainContent .file-row").length&&(ASC.Files.UI.lastSelectedEntry=jq("#filesMainContent .file-row:has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return{entryType:n.entryType,entryId:n.entryId}}));ASC.Files.Anchor.move(n,t===!0)},v=function(n,t){ASC.Files.UI.resetSelectAll();ASC.Files.UI.amountPage=0;t=t===!0;ASC.Files.Common.isCorrectId(n)?(t&&ASC.Files.Folders.currentFolder.id==n||(ASC.Files.Folders.currentFolder.id=n,ASC.Files.Folders.folderContainer=""),i(null,t)):(ASC.Files.Folders.currentFolder.id="",ASC.Files.Folders.folderContainer=n,i(n,t))},y=function(){if(!ASC.Resources.Master.IsAuthenticated){if(!ASC.Files.Tree.externalFolderIdCurrentRoot){location.reload(!0);return}ASC.Files.Anchor.navigationSet(ASC.Files.Tree.externalFolderIdCurrentRoot);return}ASC.Files.Tree&&(ASC.Files.Filter.clearFilter(!0),ASC.Files.Tree.folderIdCurrentRoot?ASC.Files.Folders.currentFolder.id!=ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Anchor.navigationSet(ASC.Files.Tree.folderIdCurrentRoot):ASC.Files.Constants.FOLDER_ID_MY_FILES?(ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_MY_FILES||ASC.Files.UI.isSettingsPanel())&&ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_MY_FILES):ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_COMMON_FILES))};return{init:r,move:a,navigationSet:v,defaultFolderSet:y,modulePath:"/Products/Files/"}}(),function(n){n(function(){var n=location.href.toLowerCase();(n.indexOf(ASC.Files.Anchor.modulePath.toLowerCase())!=-1||n.indexOf("/products/projects/tmdocs.aspx"))&&ASC.Files.Anchor.init()})}(jQuery);
window.ASC.Files.FileChoice=function(){var n=!1,t=!1,i=function(t,i,r,u,f,e){if(u&&(r=undefined),n===!1){n=!0;typeof r=="string"&&(r=r==""?undefined:r=="true");jq("#fileSelectorTree").css("visibility","visible");jq("#mainContent").addClass("webkit-scrollbar");var o=function(){ASC.Files.FileSelector.openDialog({folderId:t,onlyFolder:i,thirdParty:r,displayPrivacy:e,scrolled:!0});i&&ASC.Files.FileChoice.eventAfter()};r&&(jq("#fileSelectorTree>ul>li:not(.third-party-entry)").toggle(!1),ASC.Files.FileSelector.createThirdPartyTree(o));i?(jq("body").addClass("only-folder"),ASC.Files.FileSelector.onSubmit=function(n){var u=ASC.Files.FileSelector.fileSelectorTree.getFolderTitle(n),e=ASC.Files.FileSelector.fileSelectorTree.getPath(n),t=jq(e).map(function(n,t){return ASC.Files.FileSelector.fileSelectorTree.getFolderTitle(t)}),i,r;t.push(u);i=t.toArray().join(" > ");r=JSON.stringify({folderId:n,pathTitle:i});window.parent.postMessage(r,f)}):(ASC.Files.Folders.eventAfter=function(){ASC.Files.FileChoice.eventAfter()},ASC.Files.FileSelector.onSubmit=function(n){if(u)t=n[0],ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetPresignedUri,function(n,t,r){if(typeof r!="undefined"){toastr.error(r);return}var u={file:n,Referer:"onlyoffice"};i=JSON.stringify(u);window.parent.postMessage(i,f)}),ASC.Files.ServiceManager.getPresignedUri(ASC.Files.ServiceManager.events.GetPresignedUri,{fileId:t.id});else{if(jq(".file-selector-files").hasClass("file-selector-single"))var t=n[0],i=JSON.stringify({fileId:t.id,fileTitle:t.title});else i=JSON.stringify({files:n,folderShareable:ASC.Files.Folders.currentFolder.shareable});window.parent.postMessage(i,f)}});ASC.Files.FileSelector.onCancel=function(){var n=JSON.stringify({file:null,Referer:"onlyoffice"});window.parent.postMessage(n,f)};jq(document).on("keyup",function(n){n.keyCode==27&&ASC.Files.FileSelector.onCancel()});r||o()}},r=function(){console.log("ASC.Files.FileChoice.eventAfter");t=!0},u=function(){return t};return{init:i,eventAfter:r,isEventAfterTriggered:u}}();
window.ASC.Files.EmptyScreen=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#emptyContainer .hintCreate",dropdownID:"hintCreatePanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintUpload",dropdownID:"hintUploadPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintOpen",dropdownID:"hintOpenPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintEdit",dropdownID:"hintEditPanel",fixWinSize:!1})},i=function(){ASC.Files.UI.hideAllContent(!0);ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting());jq("#filesMainContent, #switchViewFolder, #mainContentHeader, #pageNavigatorHolder, #filesBreadCrumbs").hide();jq("#emptyContainer > div").hide();ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet||ASC.Files.FileSelector&&ASC.Files.FileSelector.filesFilterText?jq("#emptyContainer_filter").show():(jq(".files-filter").hide(),jq("#emptyContainer .empty-folder-create").toggle(ASC.Files.Folders.folderContainer=="privacy"?!!ASC.Desktop:ASC.Files.UI.accessEdit()),!ASC.Files.Tree||ASC.Files.Tree.pathParts.length>1||!ASC.Resources.Master.IsAuthenticated?(jq("#emptyContainer_subfolder").show(),ASC.Files.UI.checkButtonBack(".empty-folder-toparent")):jq("#emptyContainer_"+ASC.Files.Folders.folderContainer).show());jq("#emptyContainer").show();ASC.Files.UI.stickContentHeader()},r=function(){jq("#filesMainContent").is(":visible")&&jq("#mainContentHeader").is(":visible")||(ASC.Files.UI.hideAllContent(!0),ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),jq("#emptyContainer").hide(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),jq(".files-filter").show(),ASC.Files.Filter&&ASC.Files.Filter.resize(),jq("#filesMainContent, #switchViewFolder, #mainContentHeader").show(),ASC.Files.UI.stickContentHeader())};return{init:t,hideEmptyScreen:r,displayEmptyScreen:i}}(),function(n){jq("#hintCreatePanel").length!=0&&(ASC.Files.EmptyScreen.init(),n(function(){}))}(jQuery);
window.ASC.Files.FileSelector=function(){var i=!1,n=!1,u=ASC.Files.Constants.FilterType.None,f=function(){},e=function(){},o=function(){return PopupKeyUpActionProvider.CloseDialog(),!1},s=function(){},h=function(){if(!i){i=!0;ASC.Files.Folders||(ASC.Files.Folders={});ASC.Files.UI.canSetDocumentTitle=!1;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetThirdPartyTree,k);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItemsTree,d);ASC.Files.FileSelector.fileSelectorTree=new ASC.Files.TreePrototype("#fileSelectorTree");var u={anykey:!0,anykeytimeout:800,colcount:3,hintDefaultDisable:!0,hasButton:!1,disableSorter:!0,maxlength:ASC.Files.Constants.MAX_NAME_LENGTH};ASC.Files.FileSelector.advansedFilter=jq(".files-folder-filter").advansedFilter(u).on("setfilter",r).on("resetfilter",r);jq("#filesMainContent").addClass("compact");jq("#fileSelectorDialog").on("click","#submitFileSelector:not(.disable)",function(){var t,i;n?t=ASC.Files.FileSelector.onSubmit(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId):(i=jq("#filesMainContent .file-row:not(.folder-row):has(.checkbox input:checked)").map(function(){return ASC.Files.UI.getObjectData(this)}),t=ASC.Files.FileSelector.onSubmit(i));t!==!1&&PopupKeyUpActionProvider.CloseDialog()});jq("#pageNavigatorHolder a").on("click",function(){t(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId,!0)});jq("#mainContent").on("scroll",function(){return jq("#filesMainContent").height()-jq("#fileSelectorDialog").height()<=jq("#mainContent").scrollTop()&&t(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId,!0),!0});jq("#filesMainContent").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(){var n=ASC.Files.UI.getObjectData(this).id;return t(n,!1,!0),!1});jq("#filesMainContent").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1});jq("#closeFileSelector").on("click",function(){ASC.Files.FileSelector.onCancel()});window.location.href.indexOf("compact")!=-1&&jq("body").addClass("file-selector-compact")}ASC.Files.FileSelector.onInit()},c=function(n){jq("#submitFileSelector").addClass("disable");var t=ASC.Files.FileSelector.fileSelectorTree.getFolderData(n);return ASC.Files.UI.accessEdit(t)&&ASC.Files.Common.isCorrectId(n)?(jq("#submitFileSelector").removeClass("disable"),!0):(ASC.Files.FileSelector.fileSelectorTree.expandFolder(n),!1)},r=function(n,i,r){ASC.Files.FileSelector.advansedFilter.advansedFilter("resize");ASC.Files.FileSelector.filesFilterText=r.params?r.params.value:"";t(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId,!1)},t=function(n,t,i){if((n||0)!=0&&(!t||jq("#pageNavigatorHolder:visible").length!=0&&jq("#pageNavigatorHolder a").text()!=ASC.Files.FilesJSResource.ButtonShowMoreLoad)){if(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId&&n!=ASC.Files.FileSelector.fileSelectorTree.selectedFolderId&&(ASC.Files.FileSelector.fileSelectorTree.setCurrent(n),ASC.Files.FileSelector.filesFilterText)){ASC.Files.FileSelector.clearFilter();return}jq("#pageNavigatorHolder a").text(ASC.Files.FilesJSResource.ButtonShowMoreLoad);jq("#submitFileSelector").addClass("disable");var r={sorter:{is_asc:!1,property:"DateAndTime"},filter:ASC.Files.FileSelector.filesFilter,text:ASC.Files.FileSelector.filesFilterText,extension:ASC.Files.FileSelector.filesFilterExtension,subject:""};ASC.Files.ServiceManager.getFolderItems(ASC.Files.ServiceManager.events.GetFolderItemsTree,{folderId:n,from:t?jq('#filesMainContent .file-row[name!="addRow"]').length:0,count:ASC.Files.Constants.COUNT_ON_PAGE,append:t===!0,filter:r.filter,subjectGroup:!1,subjectId:r.subject,search:r.text,orderBy:r.sorter,searchInContent:!1,extension:r.extension,withSubfolders:r.text!="",currentFolderId:ASC.Files.Folders&&ASC.Files.Folders.currentFolder?ASC.Files.Folders.currentFolder.id:null,expandTree:i},{orderBy:r.sorter})}},l=function(){jq("#submitFileSelector").toggleClass("disable",!jq("#filesMainContent .file-row:not(.folder-row):has(.checkbox input:checked)").length)},a=function(n){jq("#fileSelectorDialog").toggleClass("hide-thirdparty",n)},v=function(i){var f,r,u;n=!jq("#mainContent").length||i.onlyFolder;ASC.Files.FileSelector.fileSelectorTree.clickOnFolder=n?c:t;jq("#fileSelectorDialog").toggleClass("only-folder",n);jq("#fileSelectorDialog").hasClass("popup-modal")&&ASC.Files.UI.blockUI("#fileSelectorDialog",n?440:1030);jq("#fileSelectorTree").toggleClass("scrolled",i.scrolled);i.displayPrivacy||(f=ASC.Files.FileSelector.fileSelectorTree.getFolderData(ASC.Files.Constants.FOLDER_ID_PRIVACY),f&&f.entryObject.addClass("privacy-node"));PopupKeyUpActionProvider.EnterAction="jq(\"#submitFileSelector\").trigger('click');";r=i.thirdParty;typeof r!="undefined"&&(jq("#fileSelectorTree>ul>li:not(.third-party-entry)").toggle(!r),ASC.Files.FileSelector.toggleThirdParty(!r));ASC.Files.FileSelector.fileSelectorTree.rollUp();u=i.folderId||ASC.Files.FileSelector.fileSelectorTree.getDefaultFolderId();n?(ASC.Files.FileSelector.fileSelectorTree.setCurrent(u),ASC.Files.FileSelector.fileSelectorTree.clickOnFolder(u)):(ASC.Files.FileSelector.fileSelectorTree.clickOnFolder(u,!1,!0),ASC.Files.UI.filesSelectedHandler=l,jq("#submitFileSelector").addClass("disable"))},y=function(){ASC.Files.FileSelector.advansedFilter.advansedFilter(null)},p=function(n){jq("#fileSelectorTitle").text((n||"").trim())},w=function(n){jq("#fileSelectorTree>ul>li.third-party-entry").each(function(t,i){var r=ASC.Files.UI.getObjectData(i);r.provider_key!=n&&jq(i).hide()})},b=function(n){ASC.Files.ServiceManager.getThirdParty(ASC.Files.ServiceManager.events.GetThirdPartyTree,{folderType:1,callback:n})},k=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(n&&n.length>0){var r=ASC.Files.Common.jsonToXml({folderList:{entry:n}}),u=ASC.Files.TemplateManager.translateFromString(r);jq("#fileSelectorTree>ul").prepend(u);ASC.Files.FileSelector.onThirdPartyTreeCreated()}t.callback&&t.callback()},d=function(n,t,i){ASC.Files.EventHandler.onGetFolderItems(n,t,i);typeof i=="undefined"&&typeof n!="undefined"&&(t.expandTree&&ASC.Files.FileSelector.fileSelectorTree.expandFolder(t.currentFolderId,!0,!0),ASC.Files.FileSelector.fileSelectorTree.setCurrent(ASC.Files.Folders.currentFolder.id),jq(".folder-row input[type='checkbox'], .folder-row input[type='radio']").prop("disabled",!0))};return{init:h,setTitle:p,openDialog:v,toggleThirdParty:a,createThirdPartyTree:b,showThirdPartyOnly:w,fileSelectorTree:{},advansedFilter:null,filesFilter:u,filesFilterText:"",filesFilterExtension:"",clearFilter:y,onInit:f,onSubmit:e,onCancel:o,onThirdPartyTreeCreated:s}}(),function(n){n(function(){if(jq("#fileSelectorDialog").length!=0){jq(".files-clear-filter").on("click",function(){return ASC.Files.FileSelector.clearFilter(),!1});ASC.Files.FileSelector.init()}})}(jQuery);
window.ASC.Files.TreePrototype=function(n,t){var r=function(n){return n==l?i:ASC.Files.UI?i.find(".tree-node"+ASC.Files.UI.getSelectorId(n)):i.find('.tree-node[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]')},u=function(n){return jq(n).attr("data-id")},s=function(n){var t=r(n);return t.parents(".jstree .tree-node")},v=function(n,t,i){(n.find("ul").html()||"").trim()!=""&&h(n);t!=""?(n.removeClass("jstree-empty").append("<ul>"+t+"<\/ul>"),n.find("ul a").each(function(){var n=u(this),t=ASC.Files.UI.getEntryLink("folder",n);jq(this).attr("href",t)}),(n.is(a)||a.has(n).length)&&n.find("li").addClass("access-read")):n.addClass("jstree-empty");n.find(".jstree-load-node").removeClass("jstree-load-node");i!==!1&&n.addClass("jstree-open").removeClass("jstree-closed")},h=function(n){n.is(".tree-node")||(n=n.find(".tree-node"));n.addClass("jstree-closed").removeClass("jstree-open jstree-empty").children("ul").remove()},e=function(n,t,i,f){if(ASC.Files.Common.isCorrectId(t))var e=r(t);else e=jq(this).parent(),t=u(e);e.length&&t!=ASC.Files.Constants.FOLDER_ID_FAVORITES&&t!=ASC.Files.Constants.FOLDER_ID_RECENT&&t!=ASC.Files.Constants.FOLDER_ID_TEMPLATES&&t!=ASC.Files.Constants.FOLDER_ID_TRASH&&(e.is(":has(ul)")?e.toggleClass("jstree-closed",i!=null?!i:null).toggleClass("jstree-open",i):p(t,f),o(!1))},y=function(){var n=jq(this).parent(),t=u(n),i=f.clickOnFolder(t)!==!1;return c(n,i),!1},o=function(n){if(i.hasClass("scrolled")){var t=i.find(".node-selected > .jstree-wholerow");t.css("width","");n||t.css("width",i.get(0).scrollWidth+"px")}},c=function(n,t){o(!0);i.find(".node-selected").removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");n.addClass("node-selected");n.parents(".jstree .jstree-closed").addClass("jstree-open").removeClass("jstree-closed");n.parents(".jstree .tree-node").addClass("parent-selected");o(!1);f.selectedFolderId=t?u(n):null},p=function(n,t){ASC.Files.Common.isCorrectId(n)&&(r(n).find(".jstree-expander").addClass("jstree-load-node"),ASC.Files.ServiceManager.getTreeSubFolders(ASC.Files.ServiceManager.events.GetTreeSubFolders,{treeNodeRoot:i,folderId:n,ajaxsync:t===!0}))},w=function(n){ASC.Files.Common.isCorrectId(n)&&ASC.Files.ServiceManager.getTreePath(ASC.Files.ServiceManager.events.GetTreePath,{folderId:n,ajaxsync:!0})},b=function(n,t,u){if(typeof u!="undefined"){f.errorMessage(u);return}var o=t.folderId,s=ASC.Files.TemplateManager.translate(n),e=r(o);if(!e.length){if(l!=null)return;e=i}v(e,s,i==t.treeNodeRoot)},k=function(n,t,i){if(typeof i!="undefined"){f.errorMessage(i);return}n.pop();jq(n).each(function(n,t){e(null,t,!0,!0)})};this.getFolderTitle=function(n){return r(n).children("a:first").text().trim()};this.getPath=function(n){return s(n).map(function(n,t){return u(t)}).toArray().reverse()};this.getParentId=function(n){var t=s(n);return t.length?u(t[0]):0};this.setCurrent=function(n){var t=r(n);t.length||(w(n),t=r(n));c(t,!0)};this.resetFolder=function(n){var t=r(n),i=t.hasClass("jstree-open");return h(t),i};this.rollUp=function(){i.removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");i.find(".jstree-open").addClass("jstree-closed").removeClass("jstree-open");f.selectedFolderId=null};this.expandFolder=function(n,t,i){return e(null,n,t,i)};this.selectedFolderId=null;this.clickOnFolder=function(){};this.errorMessage=function(n){ASC.Files.UI&&ASC.Files.UI.displayInfoPanel(n,!0)};this.getFolderData=function(n){var t=r(n);return ASC.Files.UI?ASC.Files.UI.getObjectData(t):{entryId:n,entryType:"folder",entryObject:t,title:getFolderTitle(n)}};this.getDefaultFolderId=function(){return u(i.find(".tree-node:visible:first"))};this.displayAsRoot=function(n){var t=r(n);jq(".jstree-root-as").removeClass("jstree-root-as");t.parents(".tree-node").addClass("jstree-root-parent").addBack().addClass("jstree-root-as");jq(".jstree-root-out").removeClass("jstree-root-out");t.parent().children('.tree-node:not([data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"])').addClass("jstree-root-out")};this.entryObject=function(){return i};var f=this,i=jq(n),l=t,a=i.find("li[data-id="+ASC.Files.Constants.FOLDER_ID_PRIVACY+"]");i.on("click",".jstree-expander",e);i.on("dblclick","a",e);i.on("click","a",y);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreeSubFolders,b);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreePath,k)};
